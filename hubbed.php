<?php
/*
Plugin Name: HUBBED Click & Collect
Plugin URI: https://hubbed.com.au
Description: HUBBED has developed a number of technology solutions that allow carriers and merchants to seamlessly integrate into the HUBBED collection point networks, and deliver various services to the delight of their customers.
Version: 4.1
Author: HUBBED
Author URI: http://hubbed.com.au/
*/
if ( ! defined( 'ABSPATH' ) ) exit;

define('HUBBED_APP_URL', 'https://apps.hubbed.com.au');
define('HUBBED_CLIENT_API_URL', 'https://production-api.hubbed.com.au/v1/');
define('HUBBED_WEB_URL', 'https://hubbed.com/wp-json/hubbedzohoapi/v1/');

define('Hubbed_API_URL', HUBBED_APP_URL.'/api'); 
define('Hubbed_DIR', plugin_dir_path(__FILE__));
define('Hubbed_URL', plugin_dir_url(__FILE__));
define('Hubbed_DEFAULT_RADIUS', 3);


//Activation Of Hubbed Plugin
if ( ! function_exists( 'hubbed_install' ) ) {
	function hubbed_install() {
		update_option('hubbed_success_install',0);
		$random_string = md5(microtime());    
		$store_id = ($random_string . substr(strftime("%Y", time()),2)); 
	  	/*
	  	if(get_option('hubbed_store_id') != null)
	  	{
	    	$store_id = get_option('hubbed_store_id');
	  	} 
	  	*/
	  	$data = array(
	  		'store_id' => $store_id,
	  		'store_key' => (get_option('hubbed_api_key')),
	  		'store_url'=> (get_site_url()),
	  		'commerce_type' => 1,
	  		'store_name'=> (get_bloginfo( 'name' ))
	  	);

	  	$body = hubbed_api_call('/storeInstall', $data);
	  	if ($body['responseCode'] == 200 && count($body['response']) > 0) 
	  	{
	  		$response = $body['response'];
	  		update_option('hubbed_store_id',sanitize_text_field($response['store_id']));
	  		update_option('hubbed_success_install',1);
	  		update_option( 'hubbed_map_key', 'AIzaSyAaCq0KCZ2j9PUX4NVQrNobf7bIqgj8Mec');
	  		update_option( 'hubbed_key_location', 'first' );
	  		update_option( 'hubbed_setting_enable', '1');
	  	}

	  }
	}
	register_activation_hook( __FILE__, 'hubbed_install' );


//De-Activation Of Hubbed Plugin
if ( ! function_exists( 'hubbed_uninstall' ) ) 
{
	function hubbed_uninstall() 
	{
		$store_id = get_option('hubbed_store_id');
	  	$data = array(
	  		'store_id' => $store_id,
	  	);

	  	$body = hubbed_api_call('/storeUnInstall', $data);
	  	if ($body['responseCode'] == 200) 
	  	{
	  		update_option('hubbed_success_install',0);
	  	}

	}
}
register_deactivation_hook( __FILE__, 'hubbed_uninstall' );




// Api CALL Function
	if ( ! function_exists( 'hubbed_api_call' ) ) {
		function hubbed_api_call($path, $fields)
		{
			$url = Hubbed_API_URL . $path;
			$args = array(
				'body' => $fields,
				'timeout' => '30',
				'redirection' => '5',
				'httpversion' => '1.0',
				'blocking' => true,
				'headers' => array(),
				'cookies' => array()
			);

			$response = wp_remote_post($url, $args);
			$body = wp_remote_retrieve_body($response);
			return json_decode($body, true);
		}
	}


//hubbed Client Api Call
	if ( ! function_exists( 'hubbed_client_api_call' ) ) {
		function hubbed_client_api_call($path,$fields,$type,$header)
		{
			$url = esc_url_raw($path);


			$apidata = array(
				'body' => $fields,
				'timeout' => '45',
				'redirection' => '5',
				'httpversion' => '1.0',
				'blocking' => true,
				'sslverify'   => false,
				'headers' => $header,
				'cookies' => array(),
			);
			if($type == 'post')
			{
				$response = wp_remote_post($url, $apidata);
			}else
			{
				$response = wp_remote_get($url, $apidata);
			}

			$body = wp_remote_retrieve_body($response);

        //print_r($body); 
			$data = json_decode($body, true);
			return $data;
		}
	}


// Check store ID And Installation or not

	if ( !empty((get_option('hubbed_store_id'))) && (get_option('hubbed_success_install')) == 1 ) 
	{

		if ( !empty(get_option('hubbed_api_key'))) {

			add_filter( 'woocommerce_ship_to_different_address_checked', '__return_true');
			add_filter( 'default_checkout_shipping_country', 'hubbed_default_checkout_shipping_country' );

			function hubbed_default_checkout_shipping_country() {
				return 'AU'; 
			}
		}


		if(is_admin())
		{
			require_once 'includes/hubbed_admin.php';
		}
		require_once 'includes/search_list.php';
		




// load admin css and script
		add_action( 'admin_enqueue_scripts', 'hubbed_load_admin_styles' );
		if ( ! function_exists( 'hubbed_load_admin_styles' ) ) {
			function hubbed_load_admin_styles() 
			{
				wp_enqueue_style( 'admin_HUBBED_css', Hubbed_URL. 'assets/admin/style.css', false, '1.0.0' );
				wp_enqueue_script( 'admin_HUBBED_js', Hubbed_URL. 'assets/admin/script.js', array('jquery'),false, '1.0.0' );
				wp_enqueue_script( 'admin_HUBBED_table_js', Hubbed_URL. 'assets/datatables.min.js', array('jquery'),false, '' );
				wp_enqueue_style( 'admin_HUBBED_table_css', Hubbed_URL. 'assets/datatables.min.css', false, '' );
				wp_enqueue_script( 'admin_HUBBED_bootstrap_js', Hubbed_URL. 'assets/bootstrap/js/bootstrap.min.js', array('jquery'),false, '' );
				wp_enqueue_style( 'admin_HUBBED_bootstrap_css', Hubbed_URL. 'assets/bootstrap/css/bootstrap.min.css',false, '' );

				wp_localize_script( 'admin_HUBBED_js', 'hubbed_admin_ajax', array( 'ajaxurl' => admin_url( 'admin-ajax.php' )));
			}
		}

  // Check the mapping of API_Key, Map_key And Store id  hubbed_map_key
		$storesetupdata =array(
			'store_key'=>(get_option('hubbed_api_key')),
			'store_id'=>(get_option('hubbed_store_id')),
			'store_url'=>(get_site_url()),

		);
		$checkstore = hubbed_api_call('/storeSetup', $storesetupdata);

		if ($checkstore['result'] == true) 
		{

// enable or disable this features
			if ((get_option( 'hubbed_setting_enable') == 1) and !empty(get_option('hubbed_api_key'))) 
			{

// load front css and script
				add_action( 'wp_enqueue_scripts', 'hubbed_load_front_styles' );
				if ( ! function_exists( 'hubbed_load_front_styles' ) ) 
				{
					function hubbed_load_front_styles() 
					{ 


						$mapjs = 'https://maps.googleapis.com/maps/api/js?key='.(get_option('hubbed_map_key'))."&libraries=places"; 
						wp_enqueue_style( 'front_HUBBED_css', Hubbed_URL. 'assets/front/style.css', false, '1.0.0' );
						wp_enqueue_script( 'front_HUBBED_js', Hubbed_URL. 'assets/front/script.js', array('jquery'),false, '1.0.0' );
						wp_enqueue_script( 'front_HUBBED_map_js', $mapjs,false, '1.0.0' );
						wp_localize_script( 'front_HUBBED_js', 'hubbed_ajax', array( 'ajaxurl' => admin_url( 'admin-ajax.php' )));
						wp_enqueue_style( 'dashicons' );


					}
				}



// Display the Click & collect Button
				$button_placment = get_option('hubbed_button_placement');
				switch ($button_placment) {
					case 'woocommerce_after_cart_totals':
					add_action('woocommerce_after_cart_totals', 'hubbed_delivery_option_function');    
					break;
					case 'woocommerce_proceed_to_checkout':
					add_action('woocommerce_proceed_to_checkout', 'hubbed_delivery_option_function');
					break;
					case 'woocommerce_before_cart_table':
					add_action('woocommerce_before_cart', 'hubbed_delivery_option_function'); 
					break;

					case 'woocommerce_before_cart_totals':
					add_action('woocommerce_before_cart_totals', 'hubbed_delivery_option_function');
					break;
					default:
					add_action('woocommerce_after_cart_totals', 'hubbed_delivery_option_function');

				} 
			//add_action('woocommerce_after_cart_totals', 'hubbed_delivery_option_function');

				if ( ! function_exists( 'hubbed_delivery_option_function' ) )
				{
					function hubbed_delivery_option_function()
					{
						$button_option = get_option('button_option');
						if($button_option == 2){
							$button_svg = '<?xml version="1.0" encoding="UTF-8"?><svg width="160px" height="46px" version="1.0" viewBox="0 0 988 287" xmlns="http://www.w3.org/2000/svg"><g transform="translate(0 287) scale(.1 -.1)"><path d="m535 2854c-256-55-466-267-519-526-24-115-24-1670 0-1786 53-262 263-472 526-526 70-14 489-16 4398-16s4328 2 4398 16c263 54 473 264 526 526 24 116 24 1670 0 1786-53 262-263 472-526 526-70 14-487 16-4405 15-3779-1-4337-3-4398-15zm8780-199c172-45 305-179 350-352 22-85 22-1651 0-1736-45-173-178-307-350-352-53-13-532-15-4375-15s-4322 2-4375 15c-172 45-305 179-350 352-22 85-22 1651 0 1736 45 171 177 306 346 351 47 13 635 15 4374 15 3849 1 4327-1 4380-14z"/><path d="m7930 2040c-260-40-459-260-477-525-20-313 215-582 527-602 164-10 308 45 425 162s169 241 168 405c0 246-155 462-383 534-89 28-184 38-260 26zm236-41c230-70 384-277 384-516 0-162-49-282-160-393-285-284-757-167-891 220-29 86-32 239-5 320 63 187 204 328 377 374 82 22 214 20 295-5z"/><path d="m8351 1715c-105-23-186-54-249-95-99-64-143-137-149-250l-5-75 28 35c37 48 191 198 217 212 12 6-10-23-49-65-73-80-147-193-137-210 3-5 39-7 83-5 143 8 195 60 257 251 40 125 56 162 86 195 20 21 20 22 1 21-10 0-48-7-83-14z"/><path d="m7564 1584c24-23 33-44 62-136 27-86 59-139 97-160 32-17 93-26 128-19l30 6-41 60c-23 33-58 78-78 99l-37 39 32-22c17-11 59-51 92-88l61-66v42c0 79-44 149-126 197-39 23-177 64-216 64-18 0-18-1-4-16z"/><path d="m1180 1842c-23-11-43-33-58-62-22-44-23-51-20-315 3-299 6-311 67-352 27-18 48-23 100-23 122 0 161 46 169 197l5 93h-67-66v-66c0-98-30-134-65-80-14 21-16 58-13 250 3 202 5 227 21 243 18 17 19 17 38-6 13-16 19-39 19-77v-54h66 67l-5 79c-5 94-29 146-78 173-45 23-133 24-180 0z"/><path d="m2250 1842c-23-11-43-33-58-62-22-44-23-51-20-315 3-299 6-311 67-352 27-18 48-23 100-23 122 0 161 46 169 197l5 93h-67-66v-66c0-98-30-134-65-80-14 21-16 58-13 250 3 202 5 227 21 243 18 17 19 17 38-6 13-16 19-39 19-77v-54h66 67l-5 79c-5 94-29 146-78 173-45 23-133 24-180 0z"/><path d="m4030 1842c-23-11-43-33-58-62-22-44-23-51-20-315 3-299 6-311 67-352 27-18 48-23 100-23 122 0 161 46 169 197l5 93h-67-66v-66c0-98-30-134-65-80-14 21-16 58-13 250 3 202 5 227 21 243 18 17 19 17 38-6 13-16 19-39 19-77v-54h66 67l-5 79c-5 94-29 146-78 173-45 23-133 24-180 0z"/><path d="m4460 1841c-19-10-44-34-55-52-18-31-20-55-23-301-3-249-2-271 17-312 28-64 68-86 154-86 82 0 117 16 149 67 23 37 23 42 23 313 0 314-4 334-76 370-51 26-142 27-189 1zm121-118c11-13 14-66 14-249 0-205-2-235-17-250-21-21-45-12-59 23-16 42-8 456 10 476 17 21 35 21 52 0z"/><path d="m6100 1842c-23-11-43-33-58-62-22-44-23-51-20-315 3-299 6-311 67-352 27-18 48-23 100-23 122 0 161 46 169 197l5 93h-67-66v-66c0-98-30-134-65-80-14 21-16 58-13 250 3 202 5 227 21 243 18 17 19 17 38-6 13-16 19-39 19-77v-54h66 67l-5 79c-5 94-29 146-78 173-45 23-133 24-180 0z"/><path d="m1540 1475v-375h155 155v55 54l-87 3-88 3-3 318-2 317h-65-65v-375z"/><path d="m1930 1475v-375h65 65v375 375h-65-65v-375z"/><path d="m2610 1475v-375h65 65v113c0 109 13 167 26 122 3-11 22-67 43-125l37-105 73-3c67-3 73-1 66 15-30 78-136 381-137 393-1 8 29 83 66 165 37 83 70 156 73 163 4 10-11 12-67 10l-72-3-47-112c-25-61-50-115-54-119s-7 47-7 114v122h-65-65v-375z"/><path d="m3370 1832c-23-11-43-33-58-62-20-39-23-56-20-131 3-69 8-91 26-117l23-31-23-31c-20-27-23-46-26-141-7-181 26-236 135-225 32 3 94 5 138 5h80l-3 165c-3 145-1 166 12 166s16 12 16 55c0 42-3 55-15 55-11 0-15 12-15 45v45h-64-65l-3-42c-3-39-5-43-28-40-42 6-55 27-55 91 0 81 11 91 101 91h74v60 60h-97c-73 0-107-4-133-18zm135-500c0-72-4-95-17-108-39-40-73 18-65 111 4 46 11 64 28 78 44 35 54 21 54-81z"/><path d="m4830 1475v-375h155 155v55 54l-87 3-88 3-3 318-2 317h-65-65v-375z"/><path d="m5220 1475v-375h155 155v55 54l-87 3-88 3-3 318-2 317h-65-65v-375z"/><path d="m5610 1475v-375h155 155v55 54l-87 3-88 3-3 103-3 102h76 75v55 54l-72 3-73 3-3 98-3 97h91 90v60 60h-155-155v-375z"/><path d="m6430 1790v-60h55 55v-315-315h65 65v315 315h55 55v60 60h-175-175v-60z"/></g></svg>';
						}else if($button_option == 3){
							$button_svg = '<?xml version="1.0" encoding="UTF-8"?><svg width="160px" height="46px" version="1.0" viewBox="0 0 988 287" xmlns="http://www.w3.org/2000/svg"><g transform="translate(0 287) scale(.1 -.1)"><path d="m535 2854c-256-55-466-267-519-526-24-115-24-1670 0-1786 53-262 263-472 526-526 70-14 489-16 4398-16s4328 2 4398 16c263 54 473 264 526 526 24 116 24 1670 0 1786-53 262-263 472-526 526-70 14-487 16-4405 15-3779-1-4337-3-4398-15zm8780-199c172-45 305-179 350-352 22-85 22-1651 0-1736-45-173-178-307-350-352-53-13-532-15-4375-15s-4322 2-4375 15c-172 45-305 179-350 352-22 85-22 1651 0 1736 45 171 177 306 346 351 47 13 635 15 4374 15 3849 1 4327-1 4380-14z"/><path d="m1810 1842c-23-11-43-33-58-62-22-44-23-51-20-315 3-299 6-311 67-352 27-18 48-23 100-23 122 0 161 46 169 197l5 93h-67-66v-66c0-98-30-134-65-80-14 21-16 58-13 250 3 202 5 227 21 243 18 17 19 17 38-6 13-16 19-39 19-77v-54h66 67l-5 79c-5 94-29 146-78 173-45 23-133 24-180 0z"/><path d="m2760 1842c-23-11-43-33-58-62-22-44-23-51-20-315 3-299 6-311 67-352 27-18 48-23 100-23 122 0 161 46 169 197l5 93h-67-66v-66c0-98-30-134-65-80-14 21-16 58-13 250 3 202 5 227 21 243 18 17 19 17 38-6 13-16 19-39 19-77v-54h66 67l-5 79c-5 94-29 146-78 173-45 23-133 24-180 0z"/><path d="m4350 1842c-23-11-43-33-58-62-22-44-23-51-20-315 3-299 6-311 67-352 27-18 48-23 100-23 122 0 161 46 169 197l5 93h-67-66v-66c0-98-30-134-65-80-14 21-16 58-13 250 3 202 5 227 21 243 18 17 19 17 38-6 13-16 19-39 19-77v-54h66 67l-5 79c-5 94-29 146-78 173-45 23-133 24-180 0z"/><path d="m4750 1841c-19-10-44-34-55-52-18-31-20-55-23-301-3-249-2-271 17-312 28-64 68-86 154-86 82 0 117 16 149 67 23 37 23 42 23 313 0 314-4 334-76 370-51 26-142 27-189 1zm121-118c11-13 14-66 14-249 0-205-2-235-17-250-21-21-45-12-59 23-16 42-8 456 10 476 17 21 35 21 52 0z"/><path d="m6230 1842c-23-11-43-33-58-62-22-44-23-51-20-315 3-299 6-311 67-352 27-18 48-23 100-23 122 0 161 46 169 197l5 93h-67-66v-66c0-98-30-134-65-80-14 21-16 58-13 250 3 202 5 227 21 243 18 17 19 17 38-6 13-16 19-39 19-77v-54h66 67l-5 79c-5 94-29 146-78 173-45 23-133 24-180 0z"/><path d="m7591 1845c-82-26-131-94-131-180 0-59 19-104 59-137 34-30 38-38 16-38-30 0-85-61-100-113-35-119 27-234 144-267 52-14 590-13 649 2 81 20 152 113 152 199 0 71-47 150-104 174l-29 13 27 17c64 42 86 158 45 242-15 30-35 52-67 71l-47 27-285 2c-221 2-295-1-329-12zm199-196v-111l-76 4c-71 3-78 6-105 36-22 24-29 42-29 73 0 78 40 108 148 109h62v-111zm376 96c78-32 80-146 4-186-23-13-56-19-97-19h-63v110 110h60c33 0 76-7 96-15zm-376-425v-120h-77c-43 0-89 6-102 13-38 19-66 64-66 106 0 87 47 120 168 121h77v-120zm406 105c70-29 83-131 24-190-29-28-36-30-120-33l-90-4v121 121h75c44 0 90-6 111-15z"/><path d="m2140 1475v-375h155 155v55 54l-87 3-88 3-3 318-2 317h-65-65v-375z"/><path d="m2490 1475v-375h65 65v375 375h-65-65v-375z"/><path d="m3090 1475v-375h65 65v113c0 109 13 167 26 122 3-11 22-67 43-125l37-105 73-3c67-3 73-1 66 15-30 78-136 381-137 393-1 8 29 83 66 165 37 83 70 156 73 163 4 10-11 12-67 10l-72-3-47-112c-25-61-50-115-54-119s-7 47-7 114v122h-65-65v-375z"/><path d="m3760 1832c-23-11-43-33-58-62-20-39-23-56-20-131 3-69 8-91 26-117l23-31-23-31c-20-27-23-46-26-141-7-181 26-236 135-225 32 3 94 5 138 5h80l-3 165c-3 145-1 166 12 166s16 12 16 55c0 42-3 55-15 55-11 0-15 12-15 45v45h-64-65l-3-42c-3-39-5-43-28-40-42 6-55 27-55 91 0 81 11 91 101 91h74v60 60h-97c-73 0-107-4-133-18zm135-500c0-72-4-95-17-108-39-40-73 18-65 111 4 46 11 64 28 78 44 35 54 21 54-81z"/><path d="m5080 1475v-375h155 155v55 54l-87 3-88 3-3 318-2 317h-65-65v-375z"/><path d="m5430 1475v-375h155 155v55 54l-87 3-88 3-3 318-2 317h-65-65v-375z"/><path d="m5780 1475v-375h155 155v55 54l-87 3-88 3-3 103-3 102h76 75v55 54l-72 3-73 3-3 98-3 97h91 90v60 60h-155-155v-375z"/><path d="m6520 1790v-60h55 55v-315-315h65 65v315 315h55 55v60 60h-175-175v-60z"/></g></svg>';
						}else if($button_option == 4){
							$button_svg = '<?xml version="1.0" encoding="UTF-8"?><svg width="160px" height="46px" version="1.0" viewBox="0 0 988 287" xmlns="http://www.w3.org/2000/svg"><g transform="translate(0 287) scale(.1 -.1)"><path d="m535 2854c-256-55-466-267-519-526-24-115-24-1670 0-1786 53-262 263-472 526-526 70-14 489-16 4398-16s4328 2 4398 16c263 54 473 264 526 526 24 116 24 1670 0 1786-53 262-263 472-526 526-70 14-487 16-4405 15-3779-1-4337-3-4398-15zm8780-199c172-45 305-179 350-352 22-85 22-1651 0-1736-45-173-178-307-350-352-53-13-532-15-4375-15s-4322 2-4375 15c-172 45-305 179-350 352-22 85-22 1651 0 1736 45 171 177 306 346 351 47 13 635 15 4374 15 3849 1 4327-1 4380-14z"/><path d="m8650 2010c-260-40-459-260-477-525-20-313 215-582 527-602 164-10 308 45 425 162s169 241 168 405c0 246-155 462-383 534-89 28-184 38-260 26zm236-41c230-70 384-277 384-516 0-162-49-282-160-393-285-284-757-167-891 220-29 86-32 239-5 320 63 187 204 328 377 374 82 22 214 20 295-5z"/><path d="m9071 1685c-105-23-186-54-249-95-99-64-143-137-149-250l-5-75 28 35c37 48 191 198 217 212 12 6-10-23-49-65-73-80-147-193-137-210 3-5 39-7 83-5 143 8 195 60 257 251 40 125 56 162 86 195 20 21 20 22 1 21-10 0-48-7-83-14z"/><path d="m8284 1554c24-23 33-44 62-136 27-86 59-139 97-160 32-17 93-26 128-19l30 6-41 60c-23 33-58 78-78 99l-37 39 32-22c17-11 59-51 92-88l61-66v42c0 79-44 149-126 197-39 23-177 64-216 64-18 0-18-1-4-16z"/><path d="m7057 1858c-77-21-137-105-137-193 1-43 32-107 68-137l31-26-28-12c-36-15-77-57-90-93-18-46-13-133 8-176 26-50 81-97 128-110 23-7 161-11 343-11 302 0 305 0 357 25 91 42 139 148 113 246-16 60-43 95-90 115l-39 18 30 18c59 36 87 155 55 231-17 43-76 93-123 106-49 14-574 13-626-1zm203-198v-110h-69c-54 0-75 5-102 23-40 27-56 72-43 119 15 52 64 78 145 78h69v-110zm373 101c44-17 67-51 67-99 0-37-6-50-34-78-32-32-38-34-105-34h-71v110 110h59c33 0 71-4 84-9zm-375-440 3-123-91 3c-91 4-92 4-126 41-45 50-48 112-6 159 32 36 74 48 157 46l60-2 3-124zm388 118c60-15 84-47 84-113 0-92-45-126-165-126h-75v125 125h56c30 0 75-5 100-11z"/><path d="m1010 1842c-23-11-43-33-58-62-22-44-23-51-20-315 3-299 6-311 67-352 27-18 48-23 100-23 122 0 161 46 169 197l5 93h-67-66v-66c0-98-30-134-65-80-14 21-16 58-13 250 3 202 5 227 21 243 18 17 19 17 38-6 13-16 19-39 19-77v-54h66 67l-5 79c-5 94-29 146-78 173-45 23-133 24-180 0z"/><path d="m2080 1842c-23-11-43-33-58-62-22-44-23-51-20-315 3-299 6-311 67-352 27-18 48-23 100-23 122 0 161 46 169 197l5 93h-67-66v-66c0-98-30-134-65-80-14 21-16 58-13 250 3 202 5 227 21 243 18 17 19 17 38-6 13-16 19-39 19-77v-54h66 67l-5 79c-5 94-29 146-78 173-45 23-133 24-180 0z"/><path d="m3860 1842c-23-11-43-33-58-62-22-44-23-51-20-315 3-299 6-311 67-352 27-18 48-23 100-23 122 0 161 46 169 197l5 93h-67-66v-66c0-98-30-134-65-80-14 21-16 58-13 250 3 202 5 227 21 243 18 17 19 17 38-6 13-16 19-39 19-77v-54h66 67l-5 79c-5 94-29 146-78 173-45 23-133 24-180 0z"/><path d="m4290 1841c-19-10-44-34-55-52-18-31-20-55-23-301-3-249-2-271 17-312 28-64 68-86 154-86 82 0 117 16 149 67 23 37 23 42 23 313 0 314-4 334-76 370-51 26-142 27-189 1zm121-118c11-13 14-66 14-249 0-205-2-235-17-250-21-21-45-12-59 23-16 42-8 456 10 476 17 21 35 21 52 0z"/><path d="m5930 1842c-23-11-43-33-58-62-22-44-23-51-20-315 3-299 6-311 67-352 27-18 48-23 100-23 122 0 161 46 169 197l5 93h-67-66v-66c0-98-30-134-65-80-14 21-16 58-13 250 3 202 5 227 21 243 18 17 19 17 38-6 13-16 19-39 19-77v-54h66 67l-5 79c-5 94-29 146-78 173-45 23-133 24-180 0z"/><path d="m1370 1475v-375h155 155v55 54l-87 3-88 3-3 318-2 317h-65-65v-375z"/><path d="m1760 1475v-375h65 65v375 375h-65-65v-375z"/><path d="m2440 1475v-375h65 65v113c0 109 13 167 26 122 3-11 22-67 43-125l37-105 73-3c67-3 73-1 66 15-30 78-136 381-137 393-1 8 29 83 66 165 37 83 70 156 73 163 4 10-11 12-67 10l-72-3-47-112c-25-61-50-115-54-119s-7 47-7 114v122h-65-65v-375z"/><path d="m3200 1832c-23-11-43-33-58-62-20-39-23-56-20-131 3-69 8-91 26-117l23-31-23-31c-20-27-23-46-26-141-7-181 26-236 135-225 32 3 94 5 138 5h80l-3 165c-3 145-1 166 12 166s16 12 16 55c0 42-3 55-15 55-11 0-15 12-15 45v45h-64-65l-3-42c-3-39-5-43-28-40-42 6-55 27-55 91 0 81 11 91 101 91h74v60 60h-97c-73 0-107-4-133-18zm135-500c0-72-4-95-17-108-39-40-73 18-65 111 4 46 11 64 28 78 44 35 54 21 54-81z"/><path d="m4660 1475v-375h155 155v55 54l-87 3-88 3-3 318-2 317h-65-65v-375z"/><path d="m5050 1475v-375h155 155v55 54l-87 3-88 3-3 318-2 317h-65-65v-375z"/><path d="m5440 1475v-375h155 155v55 54l-87 3-88 3-3 103-3 102h76 75v55 54l-72 3-73 3-3 98-3 97h91 90v60 60h-155-155v-375z"/><path d="m6260 1790v-60h55 55v-315-315h65 65v315 315h55 55v60 60h-175-175v-60z"/></g></svg>';
						}else{
							$button_svg = '<?xml version="1.0" encoding="UTF-8"?><svg width="160px" height="46px" version="1.0" viewBox="0 0 988 287" xmlns="http://www.w3.org/2000/svg"><g transform="translate(0 287) scale(.1 -.1)"><path d="m535 2854c-256-55-466-267-519-526-24-115-24-1670 0-1786 53-262 263-472 526-526 70-14 489-16 4398-16s4328 2 4398 16c263 54 473 264 526 526 24 116 24 1670 0 1786-53 262-263 472-526 526-70 14-487 16-4405 15-3779-1-4337-3-4398-15zm8780-199c172-45 305-179 350-352 22-85 22-1651 0-1736-45-173-178-307-350-352-53-13-532-15-4375-15s-4322 2-4375 15c-172 45-305 179-350 352-22 85-22 1651 0 1736 45 171 177 306 346 351 47 13 635 15 4374 15 3849 1 4327-1 4380-14z"/><path d="m2190 1842c-23-11-43-33-58-62-22-44-23-51-20-315 3-299 6-311 67-352 27-18 48-23 100-23 122 0 161 46 169 197l5 93h-67-66v-66c0-98-30-134-65-80-14 21-16 58-13 250 3 202 5 227 21 243 18 17 19 17 38-6 13-16 19-39 19-77v-54h66 67l-5 79c-5 94-29 146-78 173-45 23-133 24-180 0z"/><path d="m3260 1842c-23-11-43-33-58-62-22-44-23-51-20-315 3-299 6-311 67-352 27-18 48-23 100-23 122 0 161 46 169 197l5 93h-67-66v-66c0-98-30-134-65-80-14 21-16 58-13 250 3 202 5 227 21 243 18 17 19 17 38-6 13-16 19-39 19-77v-54h66 67l-5 79c-5 94-29 146-78 173-45 23-133 24-180 0z"/><path d="m5040 1842c-23-11-43-33-58-62-22-44-23-51-20-315 3-299 6-311 67-352 27-18 48-23 100-23 122 0 161 46 169 197l5 93h-67-66v-66c0-98-30-134-65-80-14 21-16 58-13 250 3 202 5 227 21 243 18 17 19 17 38-6 13-16 19-39 19-77v-54h66 67l-5 79c-5 94-29 146-78 173-45 23-133 24-180 0z"/><path d="m5470 1841c-19-10-44-34-55-52-18-31-20-55-23-301-3-249-2-271 17-312 28-64 68-86 154-86 82 0 117 16 149 67 23 37 23 42 23 313 0 314-4 334-76 370-51 26-142 27-189 1zm121-118c11-13 14-66 14-249 0-205-2-235-17-250-21-21-45-12-59 23-16 42-8 456 10 476 17 21 35 21 52 0z"/><path d="m7110 1842c-23-11-43-33-58-62-22-44-23-51-20-315 3-299 6-311 67-352 27-18 48-23 100-23 122 0 161 46 169 197l5 93h-67-66v-66c0-98-30-134-65-80-14 21-16 58-13 250 3 202 5 227 21 243 18 17 19 17 38-6 13-16 19-39 19-77v-54h66 67l-5 79c-5 94-29 146-78 173-45 23-133 24-180 0z"/><path d="m2550 1475v-375h155 155v55 54l-87 3-88 3-3 318-2 317h-65-65v-375z"/><path d="m2940 1475v-375h65 65v375 375h-65-65v-375z"/><path d="m3620 1475v-375h65 65v113c0 109 13 167 26 122 3-11 22-67 43-125l37-105 73-3c67-3 73-1 66 15-30 78-136 381-137 393-1 8 29 83 66 165 37 83 70 156 73 163 4 10-11 12-67 10l-72-3-47-112c-25-61-50-115-54-119s-7 47-7 114v122h-65-65v-375z"/><path d="m4380 1832c-23-11-43-33-58-62-20-39-23-56-20-131 3-69 8-91 26-117l23-31-23-31c-20-27-23-46-26-141-7-181 26-236 135-225 32 3 94 5 138 5h80l-3 165c-3 145-1 166 12 166s16 12 16 55c0 42-3 55-15 55-11 0-15 12-15 45v45h-64-65l-3-42c-3-39-5-43-28-40-42 6-55 27-55 91 0 81 11 91 101 91h74v60 60h-97c-73 0-107-4-133-18zm135-500c0-72-4-95-17-108-39-40-73 18-65 111 4 46 11 64 28 78 44 35 54 21 54-81z"/><path d="m5840 1475v-375h155 155v55 54l-87 3-88 3-3 318-2 317h-65-65v-375z"/><path d="m6230 1475v-375h155 155v55 54l-87 3-88 3-3 318-2 317h-65-65v-375z"/><path d="m6620 1475v-375h155 155v55 54l-87 3-88 3-3 103-3 102h76 75v55 54l-72 3-73 3-3 98-3 97h91 90v60 60h-155-155v-375z"/><path d="m7440 1790v-60h55 55v-315-315h65 65v315 315h55 55v60 60h-175-175v-60z"/></g></svg>';
						}
						$infoSVG ='<svg version="1.0" xmlns="http://www.w3.org/2000/svg" width="682.667" height="682.667" viewBox="0 0 512 512"><path d="M232.1 1c-49.7 4.8-99 25.1-137.6 56.5-11.4 9.2-29.4 27.4-38.4 38.7-22.9 28.7-41.7 67.5-49.5 102.3-4.9 21.8-6 32.5-6 57.5s1.1 35.7 6 57.5c7.9 35.5 27.2 74.9 50.9 104 9.2 11.4 27.4 29.4 38.7 38.4 28.7 22.9 67.5 41.7 102.3 49.5 21.8 4.9 32.5 6 57.5 6s35.7-1.1 57.5-6c26.1-5.8 60.3-20.4 82.8-35.3 38.9-25.9 68.8-59.9 89.3-101.6 12.5-25.5 19.6-48.4 24.1-77.5 2.4-16.1 2.4-53.9 0-70-4.5-29.1-11.6-52-24.1-77.5-13.4-27.2-28.3-48-49.8-69.2-21.1-20.9-40.4-34.6-67.3-47.8-25.2-12.4-48.6-19.7-76.5-24C279.4.6 245.2-.2 232.1 1zM288 25.6c50.8 7.4 96.7 30.3 132.4 66 35.9 35.8 58.1 80.4 66.2 132.9 1.2 7.7 1.7 17.2 1.7 31.5 0 37.8-7.5 69.8-24 103.2-34.3 69.3-98 115.2-176.8 127.4-15.1 2.3-47.9 2.3-63 0-52.5-8.1-97.1-30.3-132.9-66.2-35.9-35.8-58.1-80.4-66.2-132.9-2.3-15.1-2.3-47.9 0-63 4.2-26.7 11.1-49.2 22.3-71.7C81.4 84.8 144.7 38.4 221 26c19.3-3.2 46.8-3.3 67-.4z"/><path d="M271.1 129.4c-9.4 3.1-18.4 11.6-21.1 20-3.1 9.8.5 22.5 8.5 29.5 17.6 15.4 47.1 8.8 54.1-12.1 6.2-18.8-8.1-37.6-29.5-38.5-4.7-.2-9.3.3-12 1.1zM238.1 215.1c-6.9 1.2-34.2 10.5-35.7 12.2-1.1 1.2-4.7 13.7-4.1 14.3.1.2 3.2-.6 6.7-1.7 14-4.4 27-2.4 30.4 4.7 3.5 7.5 1.8 18-9.4 56.1-8.6 29.4-10.1 36.4-10.2 47.8-.1 7.4.3 9.9 2.1 14.2 3 6.7 10.3 13.6 18.9 17.6 6 2.8 7.8 3.1 18.3 3.5 14.1.5 20.7-.8 39.4-7.6l13-4.8 1.9-6.7c1.1-3.7 1.7-6.9 1.4-7.2-.3-.3-2.5.2-4.9 1.1-6.5 2.5-23.3 2.5-27.7.1-10.4-5.7-9.8-15.3 4.2-63.4 8.8-30.1 9.6-33.8 9.7-45.5.1-16.7-5.3-25.3-20.1-32.1-5.8-2.7-7.7-3.1-17.5-3.3-6-.2-13.5.1-16.4.7z"/></svg>';
						echo sprintf( '<div class="wc-proceed-to-checkout input-group">
							<div class="input-group-btn">
							<span id="hubbed-btn-click-collect" class="hubbed-popup-button hubbed-toggle hubbed-clickbtn">%s</span>
							<span class="hubbed-learn-more" onclick="learnMorePopupHubbed(event)">%s</span></div>
							</div>
							</div>',$button_svg,$infoSVG);
    // Add the hubbed popup

							if ( is_cart() ) 
							{
								include_once 'includes/location-popup.php';
							}
					} 
				}

			// mini cart page
				
				$button_placment_mini = get_option('hubbed_button_placement_mini');
				switch ($button_placment_mini) 
				{
					case 'woocommerce_after_mini_cart':
					add_action( 'woocommerce_after_mini_cart', 'hubbed_delivery_minicartoption_function', 10, 0 );    
					break;
					case 'woocommerce_before_mini_cart':
					add_action( 'woocommerce_before_mini_cart', 'hubbed_delivery_minicartoption_function', 10, 0 );
					break;
					default:
					
				} 
				
				if ( ! function_exists( 'hubbed_delivery_minicartoption_function' ) )
				{
					function hubbed_delivery_minicartoption_function()
					{
						$items_count = WC()->cart->get_cart_contents_count();
						
						if ($items_count && ! is_cart()) 
						{
							$button_option = get_option('button_option');
							if($button_option == 2){
								$button_svg = '<?xml version="1.0" encoding="UTF-8"?><svg width="160px" height="46px" version="1.0" viewBox="0 0 988 287" xmlns="http://www.w3.org/2000/svg"><g transform="translate(0 287) scale(.1 -.1)"><path d="m535 2854c-256-55-466-267-519-526-24-115-24-1670 0-1786 53-262 263-472 526-526 70-14 489-16 4398-16s4328 2 4398 16c263 54 473 264 526 526 24 116 24 1670 0 1786-53 262-263 472-526 526-70 14-487 16-4405 15-3779-1-4337-3-4398-15zm8780-199c172-45 305-179 350-352 22-85 22-1651 0-1736-45-173-178-307-350-352-53-13-532-15-4375-15s-4322 2-4375 15c-172 45-305 179-350 352-22 85-22 1651 0 1736 45 171 177 306 346 351 47 13 635 15 4374 15 3849 1 4327-1 4380-14z"/><path d="m7930 2040c-260-40-459-260-477-525-20-313 215-582 527-602 164-10 308 45 425 162s169 241 168 405c0 246-155 462-383 534-89 28-184 38-260 26zm236-41c230-70 384-277 384-516 0-162-49-282-160-393-285-284-757-167-891 220-29 86-32 239-5 320 63 187 204 328 377 374 82 22 214 20 295-5z"/><path d="m8351 1715c-105-23-186-54-249-95-99-64-143-137-149-250l-5-75 28 35c37 48 191 198 217 212 12 6-10-23-49-65-73-80-147-193-137-210 3-5 39-7 83-5 143 8 195 60 257 251 40 125 56 162 86 195 20 21 20 22 1 21-10 0-48-7-83-14z"/><path d="m7564 1584c24-23 33-44 62-136 27-86 59-139 97-160 32-17 93-26 128-19l30 6-41 60c-23 33-58 78-78 99l-37 39 32-22c17-11 59-51 92-88l61-66v42c0 79-44 149-126 197-39 23-177 64-216 64-18 0-18-1-4-16z"/><path d="m1180 1842c-23-11-43-33-58-62-22-44-23-51-20-315 3-299 6-311 67-352 27-18 48-23 100-23 122 0 161 46 169 197l5 93h-67-66v-66c0-98-30-134-65-80-14 21-16 58-13 250 3 202 5 227 21 243 18 17 19 17 38-6 13-16 19-39 19-77v-54h66 67l-5 79c-5 94-29 146-78 173-45 23-133 24-180 0z"/><path d="m2250 1842c-23-11-43-33-58-62-22-44-23-51-20-315 3-299 6-311 67-352 27-18 48-23 100-23 122 0 161 46 169 197l5 93h-67-66v-66c0-98-30-134-65-80-14 21-16 58-13 250 3 202 5 227 21 243 18 17 19 17 38-6 13-16 19-39 19-77v-54h66 67l-5 79c-5 94-29 146-78 173-45 23-133 24-180 0z"/><path d="m4030 1842c-23-11-43-33-58-62-22-44-23-51-20-315 3-299 6-311 67-352 27-18 48-23 100-23 122 0 161 46 169 197l5 93h-67-66v-66c0-98-30-134-65-80-14 21-16 58-13 250 3 202 5 227 21 243 18 17 19 17 38-6 13-16 19-39 19-77v-54h66 67l-5 79c-5 94-29 146-78 173-45 23-133 24-180 0z"/><path d="m4460 1841c-19-10-44-34-55-52-18-31-20-55-23-301-3-249-2-271 17-312 28-64 68-86 154-86 82 0 117 16 149 67 23 37 23 42 23 313 0 314-4 334-76 370-51 26-142 27-189 1zm121-118c11-13 14-66 14-249 0-205-2-235-17-250-21-21-45-12-59 23-16 42-8 456 10 476 17 21 35 21 52 0z"/><path d="m6100 1842c-23-11-43-33-58-62-22-44-23-51-20-315 3-299 6-311 67-352 27-18 48-23 100-23 122 0 161 46 169 197l5 93h-67-66v-66c0-98-30-134-65-80-14 21-16 58-13 250 3 202 5 227 21 243 18 17 19 17 38-6 13-16 19-39 19-77v-54h66 67l-5 79c-5 94-29 146-78 173-45 23-133 24-180 0z"/><path d="m1540 1475v-375h155 155v55 54l-87 3-88 3-3 318-2 317h-65-65v-375z"/><path d="m1930 1475v-375h65 65v375 375h-65-65v-375z"/><path d="m2610 1475v-375h65 65v113c0 109 13 167 26 122 3-11 22-67 43-125l37-105 73-3c67-3 73-1 66 15-30 78-136 381-137 393-1 8 29 83 66 165 37 83 70 156 73 163 4 10-11 12-67 10l-72-3-47-112c-25-61-50-115-54-119s-7 47-7 114v122h-65-65v-375z"/><path d="m3370 1832c-23-11-43-33-58-62-20-39-23-56-20-131 3-69 8-91 26-117l23-31-23-31c-20-27-23-46-26-141-7-181 26-236 135-225 32 3 94 5 138 5h80l-3 165c-3 145-1 166 12 166s16 12 16 55c0 42-3 55-15 55-11 0-15 12-15 45v45h-64-65l-3-42c-3-39-5-43-28-40-42 6-55 27-55 91 0 81 11 91 101 91h74v60 60h-97c-73 0-107-4-133-18zm135-500c0-72-4-95-17-108-39-40-73 18-65 111 4 46 11 64 28 78 44 35 54 21 54-81z"/><path d="m4830 1475v-375h155 155v55 54l-87 3-88 3-3 318-2 317h-65-65v-375z"/><path d="m5220 1475v-375h155 155v55 54l-87 3-88 3-3 318-2 317h-65-65v-375z"/><path d="m5610 1475v-375h155 155v55 54l-87 3-88 3-3 103-3 102h76 75v55 54l-72 3-73 3-3 98-3 97h91 90v60 60h-155-155v-375z"/><path d="m6430 1790v-60h55 55v-315-315h65 65v315 315h55 55v60 60h-175-175v-60z"/></g></svg>';
							}else if($button_option == 3){
								$button_svg = '<?xml version="1.0" encoding="UTF-8"?><svg width="160px" height="46px" version="1.0" viewBox="0 0 988 287" xmlns="http://www.w3.org/2000/svg"><g transform="translate(0 287) scale(.1 -.1)"><path d="m535 2854c-256-55-466-267-519-526-24-115-24-1670 0-1786 53-262 263-472 526-526 70-14 489-16 4398-16s4328 2 4398 16c263 54 473 264 526 526 24 116 24 1670 0 1786-53 262-263 472-526 526-70 14-487 16-4405 15-3779-1-4337-3-4398-15zm8780-199c172-45 305-179 350-352 22-85 22-1651 0-1736-45-173-178-307-350-352-53-13-532-15-4375-15s-4322 2-4375 15c-172 45-305 179-350 352-22 85-22 1651 0 1736 45 171 177 306 346 351 47 13 635 15 4374 15 3849 1 4327-1 4380-14z"/><path d="m1810 1842c-23-11-43-33-58-62-22-44-23-51-20-315 3-299 6-311 67-352 27-18 48-23 100-23 122 0 161 46 169 197l5 93h-67-66v-66c0-98-30-134-65-80-14 21-16 58-13 250 3 202 5 227 21 243 18 17 19 17 38-6 13-16 19-39 19-77v-54h66 67l-5 79c-5 94-29 146-78 173-45 23-133 24-180 0z"/><path d="m2760 1842c-23-11-43-33-58-62-22-44-23-51-20-315 3-299 6-311 67-352 27-18 48-23 100-23 122 0 161 46 169 197l5 93h-67-66v-66c0-98-30-134-65-80-14 21-16 58-13 250 3 202 5 227 21 243 18 17 19 17 38-6 13-16 19-39 19-77v-54h66 67l-5 79c-5 94-29 146-78 173-45 23-133 24-180 0z"/><path d="m4350 1842c-23-11-43-33-58-62-22-44-23-51-20-315 3-299 6-311 67-352 27-18 48-23 100-23 122 0 161 46 169 197l5 93h-67-66v-66c0-98-30-134-65-80-14 21-16 58-13 250 3 202 5 227 21 243 18 17 19 17 38-6 13-16 19-39 19-77v-54h66 67l-5 79c-5 94-29 146-78 173-45 23-133 24-180 0z"/><path d="m4750 1841c-19-10-44-34-55-52-18-31-20-55-23-301-3-249-2-271 17-312 28-64 68-86 154-86 82 0 117 16 149 67 23 37 23 42 23 313 0 314-4 334-76 370-51 26-142 27-189 1zm121-118c11-13 14-66 14-249 0-205-2-235-17-250-21-21-45-12-59 23-16 42-8 456 10 476 17 21 35 21 52 0z"/><path d="m6230 1842c-23-11-43-33-58-62-22-44-23-51-20-315 3-299 6-311 67-352 27-18 48-23 100-23 122 0 161 46 169 197l5 93h-67-66v-66c0-98-30-134-65-80-14 21-16 58-13 250 3 202 5 227 21 243 18 17 19 17 38-6 13-16 19-39 19-77v-54h66 67l-5 79c-5 94-29 146-78 173-45 23-133 24-180 0z"/><path d="m7591 1845c-82-26-131-94-131-180 0-59 19-104 59-137 34-30 38-38 16-38-30 0-85-61-100-113-35-119 27-234 144-267 52-14 590-13 649 2 81 20 152 113 152 199 0 71-47 150-104 174l-29 13 27 17c64 42 86 158 45 242-15 30-35 52-67 71l-47 27-285 2c-221 2-295-1-329-12zm199-196v-111l-76 4c-71 3-78 6-105 36-22 24-29 42-29 73 0 78 40 108 148 109h62v-111zm376 96c78-32 80-146 4-186-23-13-56-19-97-19h-63v110 110h60c33 0 76-7 96-15zm-376-425v-120h-77c-43 0-89 6-102 13-38 19-66 64-66 106 0 87 47 120 168 121h77v-120zm406 105c70-29 83-131 24-190-29-28-36-30-120-33l-90-4v121 121h75c44 0 90-6 111-15z"/><path d="m2140 1475v-375h155 155v55 54l-87 3-88 3-3 318-2 317h-65-65v-375z"/><path d="m2490 1475v-375h65 65v375 375h-65-65v-375z"/><path d="m3090 1475v-375h65 65v113c0 109 13 167 26 122 3-11 22-67 43-125l37-105 73-3c67-3 73-1 66 15-30 78-136 381-137 393-1 8 29 83 66 165 37 83 70 156 73 163 4 10-11 12-67 10l-72-3-47-112c-25-61-50-115-54-119s-7 47-7 114v122h-65-65v-375z"/><path d="m3760 1832c-23-11-43-33-58-62-20-39-23-56-20-131 3-69 8-91 26-117l23-31-23-31c-20-27-23-46-26-141-7-181 26-236 135-225 32 3 94 5 138 5h80l-3 165c-3 145-1 166 12 166s16 12 16 55c0 42-3 55-15 55-11 0-15 12-15 45v45h-64-65l-3-42c-3-39-5-43-28-40-42 6-55 27-55 91 0 81 11 91 101 91h74v60 60h-97c-73 0-107-4-133-18zm135-500c0-72-4-95-17-108-39-40-73 18-65 111 4 46 11 64 28 78 44 35 54 21 54-81z"/><path d="m5080 1475v-375h155 155v55 54l-87 3-88 3-3 318-2 317h-65-65v-375z"/><path d="m5430 1475v-375h155 155v55 54l-87 3-88 3-3 318-2 317h-65-65v-375z"/><path d="m5780 1475v-375h155 155v55 54l-87 3-88 3-3 103-3 102h76 75v55 54l-72 3-73 3-3 98-3 97h91 90v60 60h-155-155v-375z"/><path d="m6520 1790v-60h55 55v-315-315h65 65v315 315h55 55v60 60h-175-175v-60z"/></g></svg>';
							}else if($button_option == 4){
								$button_svg = '<?xml version="1.0" encoding="UTF-8"?><svg width="160px" height="46px" version="1.0" viewBox="0 0 988 287" xmlns="http://www.w3.org/2000/svg"><g transform="translate(0 287) scale(.1 -.1)"><path d="m535 2854c-256-55-466-267-519-526-24-115-24-1670 0-1786 53-262 263-472 526-526 70-14 489-16 4398-16s4328 2 4398 16c263 54 473 264 526 526 24 116 24 1670 0 1786-53 262-263 472-526 526-70 14-487 16-4405 15-3779-1-4337-3-4398-15zm8780-199c172-45 305-179 350-352 22-85 22-1651 0-1736-45-173-178-307-350-352-53-13-532-15-4375-15s-4322 2-4375 15c-172 45-305 179-350 352-22 85-22 1651 0 1736 45 171 177 306 346 351 47 13 635 15 4374 15 3849 1 4327-1 4380-14z"/><path d="m8650 2010c-260-40-459-260-477-525-20-313 215-582 527-602 164-10 308 45 425 162s169 241 168 405c0 246-155 462-383 534-89 28-184 38-260 26zm236-41c230-70 384-277 384-516 0-162-49-282-160-393-285-284-757-167-891 220-29 86-32 239-5 320 63 187 204 328 377 374 82 22 214 20 295-5z"/><path d="m9071 1685c-105-23-186-54-249-95-99-64-143-137-149-250l-5-75 28 35c37 48 191 198 217 212 12 6-10-23-49-65-73-80-147-193-137-210 3-5 39-7 83-5 143 8 195 60 257 251 40 125 56 162 86 195 20 21 20 22 1 21-10 0-48-7-83-14z"/><path d="m8284 1554c24-23 33-44 62-136 27-86 59-139 97-160 32-17 93-26 128-19l30 6-41 60c-23 33-58 78-78 99l-37 39 32-22c17-11 59-51 92-88l61-66v42c0 79-44 149-126 197-39 23-177 64-216 64-18 0-18-1-4-16z"/><path d="m7057 1858c-77-21-137-105-137-193 1-43 32-107 68-137l31-26-28-12c-36-15-77-57-90-93-18-46-13-133 8-176 26-50 81-97 128-110 23-7 161-11 343-11 302 0 305 0 357 25 91 42 139 148 113 246-16 60-43 95-90 115l-39 18 30 18c59 36 87 155 55 231-17 43-76 93-123 106-49 14-574 13-626-1zm203-198v-110h-69c-54 0-75 5-102 23-40 27-56 72-43 119 15 52 64 78 145 78h69v-110zm373 101c44-17 67-51 67-99 0-37-6-50-34-78-32-32-38-34-105-34h-71v110 110h59c33 0 71-4 84-9zm-375-440 3-123-91 3c-91 4-92 4-126 41-45 50-48 112-6 159 32 36 74 48 157 46l60-2 3-124zm388 118c60-15 84-47 84-113 0-92-45-126-165-126h-75v125 125h56c30 0 75-5 100-11z"/><path d="m1010 1842c-23-11-43-33-58-62-22-44-23-51-20-315 3-299 6-311 67-352 27-18 48-23 100-23 122 0 161 46 169 197l5 93h-67-66v-66c0-98-30-134-65-80-14 21-16 58-13 250 3 202 5 227 21 243 18 17 19 17 38-6 13-16 19-39 19-77v-54h66 67l-5 79c-5 94-29 146-78 173-45 23-133 24-180 0z"/><path d="m2080 1842c-23-11-43-33-58-62-22-44-23-51-20-315 3-299 6-311 67-352 27-18 48-23 100-23 122 0 161 46 169 197l5 93h-67-66v-66c0-98-30-134-65-80-14 21-16 58-13 250 3 202 5 227 21 243 18 17 19 17 38-6 13-16 19-39 19-77v-54h66 67l-5 79c-5 94-29 146-78 173-45 23-133 24-180 0z"/><path d="m3860 1842c-23-11-43-33-58-62-22-44-23-51-20-315 3-299 6-311 67-352 27-18 48-23 100-23 122 0 161 46 169 197l5 93h-67-66v-66c0-98-30-134-65-80-14 21-16 58-13 250 3 202 5 227 21 243 18 17 19 17 38-6 13-16 19-39 19-77v-54h66 67l-5 79c-5 94-29 146-78 173-45 23-133 24-180 0z"/><path d="m4290 1841c-19-10-44-34-55-52-18-31-20-55-23-301-3-249-2-271 17-312 28-64 68-86 154-86 82 0 117 16 149 67 23 37 23 42 23 313 0 314-4 334-76 370-51 26-142 27-189 1zm121-118c11-13 14-66 14-249 0-205-2-235-17-250-21-21-45-12-59 23-16 42-8 456 10 476 17 21 35 21 52 0z"/><path d="m5930 1842c-23-11-43-33-58-62-22-44-23-51-20-315 3-299 6-311 67-352 27-18 48-23 100-23 122 0 161 46 169 197l5 93h-67-66v-66c0-98-30-134-65-80-14 21-16 58-13 250 3 202 5 227 21 243 18 17 19 17 38-6 13-16 19-39 19-77v-54h66 67l-5 79c-5 94-29 146-78 173-45 23-133 24-180 0z"/><path d="m1370 1475v-375h155 155v55 54l-87 3-88 3-3 318-2 317h-65-65v-375z"/><path d="m1760 1475v-375h65 65v375 375h-65-65v-375z"/><path d="m2440 1475v-375h65 65v113c0 109 13 167 26 122 3-11 22-67 43-125l37-105 73-3c67-3 73-1 66 15-30 78-136 381-137 393-1 8 29 83 66 165 37 83 70 156 73 163 4 10-11 12-67 10l-72-3-47-112c-25-61-50-115-54-119s-7 47-7 114v122h-65-65v-375z"/><path d="m3200 1832c-23-11-43-33-58-62-20-39-23-56-20-131 3-69 8-91 26-117l23-31-23-31c-20-27-23-46-26-141-7-181 26-236 135-225 32 3 94 5 138 5h80l-3 165c-3 145-1 166 12 166s16 12 16 55c0 42-3 55-15 55-11 0-15 12-15 45v45h-64-65l-3-42c-3-39-5-43-28-40-42 6-55 27-55 91 0 81 11 91 101 91h74v60 60h-97c-73 0-107-4-133-18zm135-500c0-72-4-95-17-108-39-40-73 18-65 111 4 46 11 64 28 78 44 35 54 21 54-81z"/><path d="m4660 1475v-375h155 155v55 54l-87 3-88 3-3 318-2 317h-65-65v-375z"/><path d="m5050 1475v-375h155 155v55 54l-87 3-88 3-3 318-2 317h-65-65v-375z"/><path d="m5440 1475v-375h155 155v55 54l-87 3-88 3-3 103-3 102h76 75v55 54l-72 3-73 3-3 98-3 97h91 90v60 60h-155-155v-375z"/><path d="m6260 1790v-60h55 55v-315-315h65 65v315 315h55 55v60 60h-175-175v-60z"/></g></svg>';
							}else{
								$button_svg = '<?xml version="1.0" encoding="UTF-8"?><svg width="160px" height="46px" version="1.0" viewBox="0 0 988 287" xmlns="http://www.w3.org/2000/svg"><g transform="translate(0 287) scale(.1 -.1)"><path d="m535 2854c-256-55-466-267-519-526-24-115-24-1670 0-1786 53-262 263-472 526-526 70-14 489-16 4398-16s4328 2 4398 16c263 54 473 264 526 526 24 116 24 1670 0 1786-53 262-263 472-526 526-70 14-487 16-4405 15-3779-1-4337-3-4398-15zm8780-199c172-45 305-179 350-352 22-85 22-1651 0-1736-45-173-178-307-350-352-53-13-532-15-4375-15s-4322 2-4375 15c-172 45-305 179-350 352-22 85-22 1651 0 1736 45 171 177 306 346 351 47 13 635 15 4374 15 3849 1 4327-1 4380-14z"/><path d="m2190 1842c-23-11-43-33-58-62-22-44-23-51-20-315 3-299 6-311 67-352 27-18 48-23 100-23 122 0 161 46 169 197l5 93h-67-66v-66c0-98-30-134-65-80-14 21-16 58-13 250 3 202 5 227 21 243 18 17 19 17 38-6 13-16 19-39 19-77v-54h66 67l-5 79c-5 94-29 146-78 173-45 23-133 24-180 0z"/><path d="m3260 1842c-23-11-43-33-58-62-22-44-23-51-20-315 3-299 6-311 67-352 27-18 48-23 100-23 122 0 161 46 169 197l5 93h-67-66v-66c0-98-30-134-65-80-14 21-16 58-13 250 3 202 5 227 21 243 18 17 19 17 38-6 13-16 19-39 19-77v-54h66 67l-5 79c-5 94-29 146-78 173-45 23-133 24-180 0z"/><path d="m5040 1842c-23-11-43-33-58-62-22-44-23-51-20-315 3-299 6-311 67-352 27-18 48-23 100-23 122 0 161 46 169 197l5 93h-67-66v-66c0-98-30-134-65-80-14 21-16 58-13 250 3 202 5 227 21 243 18 17 19 17 38-6 13-16 19-39 19-77v-54h66 67l-5 79c-5 94-29 146-78 173-45 23-133 24-180 0z"/><path d="m5470 1841c-19-10-44-34-55-52-18-31-20-55-23-301-3-249-2-271 17-312 28-64 68-86 154-86 82 0 117 16 149 67 23 37 23 42 23 313 0 314-4 334-76 370-51 26-142 27-189 1zm121-118c11-13 14-66 14-249 0-205-2-235-17-250-21-21-45-12-59 23-16 42-8 456 10 476 17 21 35 21 52 0z"/><path d="m7110 1842c-23-11-43-33-58-62-22-44-23-51-20-315 3-299 6-311 67-352 27-18 48-23 100-23 122 0 161 46 169 197l5 93h-67-66v-66c0-98-30-134-65-80-14 21-16 58-13 250 3 202 5 227 21 243 18 17 19 17 38-6 13-16 19-39 19-77v-54h66 67l-5 79c-5 94-29 146-78 173-45 23-133 24-180 0z"/><path d="m2550 1475v-375h155 155v55 54l-87 3-88 3-3 318-2 317h-65-65v-375z"/><path d="m2940 1475v-375h65 65v375 375h-65-65v-375z"/><path d="m3620 1475v-375h65 65v113c0 109 13 167 26 122 3-11 22-67 43-125l37-105 73-3c67-3 73-1 66 15-30 78-136 381-137 393-1 8 29 83 66 165 37 83 70 156 73 163 4 10-11 12-67 10l-72-3-47-112c-25-61-50-115-54-119s-7 47-7 114v122h-65-65v-375z"/><path d="m4380 1832c-23-11-43-33-58-62-20-39-23-56-20-131 3-69 8-91 26-117l23-31-23-31c-20-27-23-46-26-141-7-181 26-236 135-225 32 3 94 5 138 5h80l-3 165c-3 145-1 166 12 166s16 12 16 55c0 42-3 55-15 55-11 0-15 12-15 45v45h-64-65l-3-42c-3-39-5-43-28-40-42 6-55 27-55 91 0 81 11 91 101 91h74v60 60h-97c-73 0-107-4-133-18zm135-500c0-72-4-95-17-108-39-40-73 18-65 111 4 46 11 64 28 78 44 35 54 21 54-81z"/><path d="m5840 1475v-375h155 155v55 54l-87 3-88 3-3 318-2 317h-65-65v-375z"/><path d="m6230 1475v-375h155 155v55 54l-87 3-88 3-3 318-2 317h-65-65v-375z"/><path d="m6620 1475v-375h155 155v55 54l-87 3-88 3-3 103-3 102h76 75v55 54l-72 3-73 3-3 98-3 97h91 90v60 60h-155-155v-375z"/><path d="m7440 1790v-60h55 55v-315-315h65 65v315 315h55 55v60 60h-175-175v-60z"/></g></svg>';
							}
							$infoSVG ='<svg version="1.0" xmlns="http://www.w3.org/2000/svg" width="682.667" height="682.667" viewBox="0 0 512 512"><path d="M232.1 1c-49.7 4.8-99 25.1-137.6 56.5-11.4 9.2-29.4 27.4-38.4 38.7-22.9 28.7-41.7 67.5-49.5 102.3-4.9 21.8-6 32.5-6 57.5s1.1 35.7 6 57.5c7.9 35.5 27.2 74.9 50.9 104 9.2 11.4 27.4 29.4 38.7 38.4 28.7 22.9 67.5 41.7 102.3 49.5 21.8 4.9 32.5 6 57.5 6s35.7-1.1 57.5-6c26.1-5.8 60.3-20.4 82.8-35.3 38.9-25.9 68.8-59.9 89.3-101.6 12.5-25.5 19.6-48.4 24.1-77.5 2.4-16.1 2.4-53.9 0-70-4.5-29.1-11.6-52-24.1-77.5-13.4-27.2-28.3-48-49.8-69.2-21.1-20.9-40.4-34.6-67.3-47.8-25.2-12.4-48.6-19.7-76.5-24C279.4.6 245.2-.2 232.1 1zM288 25.6c50.8 7.4 96.7 30.3 132.4 66 35.9 35.8 58.1 80.4 66.2 132.9 1.2 7.7 1.7 17.2 1.7 31.5 0 37.8-7.5 69.8-24 103.2-34.3 69.3-98 115.2-176.8 127.4-15.1 2.3-47.9 2.3-63 0-52.5-8.1-97.1-30.3-132.9-66.2-35.9-35.8-58.1-80.4-66.2-132.9-2.3-15.1-2.3-47.9 0-63 4.2-26.7 11.1-49.2 22.3-71.7C81.4 84.8 144.7 38.4 221 26c19.3-3.2 46.8-3.3 67-.4z"/><path d="M271.1 129.4c-9.4 3.1-18.4 11.6-21.1 20-3.1 9.8.5 22.5 8.5 29.5 17.6 15.4 47.1 8.8 54.1-12.1 6.2-18.8-8.1-37.6-29.5-38.5-4.7-.2-9.3.3-12 1.1zM238.1 215.1c-6.9 1.2-34.2 10.5-35.7 12.2-1.1 1.2-4.7 13.7-4.1 14.3.1.2 3.2-.6 6.7-1.7 14-4.4 27-2.4 30.4 4.7 3.5 7.5 1.8 18-9.4 56.1-8.6 29.4-10.1 36.4-10.2 47.8-.1 7.4.3 9.9 2.1 14.2 3 6.7 10.3 13.6 18.9 17.6 6 2.8 7.8 3.1 18.3 3.5 14.1.5 20.7-.8 39.4-7.6l13-4.8 1.9-6.7c1.1-3.7 1.7-6.9 1.4-7.2-.3-.3-2.5.2-4.9 1.1-6.5 2.5-23.3 2.5-27.7.1-10.4-5.7-9.8-15.3 4.2-63.4 8.8-30.1 9.6-33.8 9.7-45.5.1-16.7-5.3-25.3-20.1-32.1-5.8-2.7-7.7-3.1-17.5-3.3-6-.2-13.5.1-16.4.7z"/></svg>';
							echo sprintf( '<div class="clear"> </div><div class="wc-proceed-to-checkout input-group">
							<div class="input-group-btn">
								<span id="hubbed-btn-click-collect" class="hubbed-popup-button hubbed-toggle hubbed-clickbtn">%s</span>
								<span class="hubbed-learn-more" onclick="learnMorePopupHubbed(event)">%s</span></div>
							</div>
							</div>',$button_svg,$infoSVG);
							// Add the hubbed popup
							include_once 'includes/location-popup.php';
							
							
						}
						
					} 
				}
			// checkout page
				$hubbed_visible_for_checkout = get_option('hubbed_visible_for_checkout');
				switch ($hubbed_visible_for_checkout) 
				{
					case 'yes':
					add_action( 'woocommerce_before_checkout_form', 'hubbed_checkout_function', 10, 0 );    
					break;
					default:
					
				} 
				
				if ( ! function_exists( 'hubbed_checkout_function' ) )
				{
					function hubbed_checkout_function()
					{
						$button_option = get_option('button_option');
						if($button_option == 2){
							$button_svg = '<?xml version="1.0" encoding="UTF-8"?><svg width="160px" height="46px" version="1.0" viewBox="0 0 988 287" xmlns="http://www.w3.org/2000/svg"><g transform="translate(0 287) scale(.1 -.1)"><path d="m535 2854c-256-55-466-267-519-526-24-115-24-1670 0-1786 53-262 263-472 526-526 70-14 489-16 4398-16s4328 2 4398 16c263 54 473 264 526 526 24 116 24 1670 0 1786-53 262-263 472-526 526-70 14-487 16-4405 15-3779-1-4337-3-4398-15zm8780-199c172-45 305-179 350-352 22-85 22-1651 0-1736-45-173-178-307-350-352-53-13-532-15-4375-15s-4322 2-4375 15c-172 45-305 179-350 352-22 85-22 1651 0 1736 45 171 177 306 346 351 47 13 635 15 4374 15 3849 1 4327-1 4380-14z"/><path d="m7930 2040c-260-40-459-260-477-525-20-313 215-582 527-602 164-10 308 45 425 162s169 241 168 405c0 246-155 462-383 534-89 28-184 38-260 26zm236-41c230-70 384-277 384-516 0-162-49-282-160-393-285-284-757-167-891 220-29 86-32 239-5 320 63 187 204 328 377 374 82 22 214 20 295-5z"/><path d="m8351 1715c-105-23-186-54-249-95-99-64-143-137-149-250l-5-75 28 35c37 48 191 198 217 212 12 6-10-23-49-65-73-80-147-193-137-210 3-5 39-7 83-5 143 8 195 60 257 251 40 125 56 162 86 195 20 21 20 22 1 21-10 0-48-7-83-14z"/><path d="m7564 1584c24-23 33-44 62-136 27-86 59-139 97-160 32-17 93-26 128-19l30 6-41 60c-23 33-58 78-78 99l-37 39 32-22c17-11 59-51 92-88l61-66v42c0 79-44 149-126 197-39 23-177 64-216 64-18 0-18-1-4-16z"/><path d="m1180 1842c-23-11-43-33-58-62-22-44-23-51-20-315 3-299 6-311 67-352 27-18 48-23 100-23 122 0 161 46 169 197l5 93h-67-66v-66c0-98-30-134-65-80-14 21-16 58-13 250 3 202 5 227 21 243 18 17 19 17 38-6 13-16 19-39 19-77v-54h66 67l-5 79c-5 94-29 146-78 173-45 23-133 24-180 0z"/><path d="m2250 1842c-23-11-43-33-58-62-22-44-23-51-20-315 3-299 6-311 67-352 27-18 48-23 100-23 122 0 161 46 169 197l5 93h-67-66v-66c0-98-30-134-65-80-14 21-16 58-13 250 3 202 5 227 21 243 18 17 19 17 38-6 13-16 19-39 19-77v-54h66 67l-5 79c-5 94-29 146-78 173-45 23-133 24-180 0z"/><path d="m4030 1842c-23-11-43-33-58-62-22-44-23-51-20-315 3-299 6-311 67-352 27-18 48-23 100-23 122 0 161 46 169 197l5 93h-67-66v-66c0-98-30-134-65-80-14 21-16 58-13 250 3 202 5 227 21 243 18 17 19 17 38-6 13-16 19-39 19-77v-54h66 67l-5 79c-5 94-29 146-78 173-45 23-133 24-180 0z"/><path d="m4460 1841c-19-10-44-34-55-52-18-31-20-55-23-301-3-249-2-271 17-312 28-64 68-86 154-86 82 0 117 16 149 67 23 37 23 42 23 313 0 314-4 334-76 370-51 26-142 27-189 1zm121-118c11-13 14-66 14-249 0-205-2-235-17-250-21-21-45-12-59 23-16 42-8 456 10 476 17 21 35 21 52 0z"/><path d="m6100 1842c-23-11-43-33-58-62-22-44-23-51-20-315 3-299 6-311 67-352 27-18 48-23 100-23 122 0 161 46 169 197l5 93h-67-66v-66c0-98-30-134-65-80-14 21-16 58-13 250 3 202 5 227 21 243 18 17 19 17 38-6 13-16 19-39 19-77v-54h66 67l-5 79c-5 94-29 146-78 173-45 23-133 24-180 0z"/><path d="m1540 1475v-375h155 155v55 54l-87 3-88 3-3 318-2 317h-65-65v-375z"/><path d="m1930 1475v-375h65 65v375 375h-65-65v-375z"/><path d="m2610 1475v-375h65 65v113c0 109 13 167 26 122 3-11 22-67 43-125l37-105 73-3c67-3 73-1 66 15-30 78-136 381-137 393-1 8 29 83 66 165 37 83 70 156 73 163 4 10-11 12-67 10l-72-3-47-112c-25-61-50-115-54-119s-7 47-7 114v122h-65-65v-375z"/><path d="m3370 1832c-23-11-43-33-58-62-20-39-23-56-20-131 3-69 8-91 26-117l23-31-23-31c-20-27-23-46-26-141-7-181 26-236 135-225 32 3 94 5 138 5h80l-3 165c-3 145-1 166 12 166s16 12 16 55c0 42-3 55-15 55-11 0-15 12-15 45v45h-64-65l-3-42c-3-39-5-43-28-40-42 6-55 27-55 91 0 81 11 91 101 91h74v60 60h-97c-73 0-107-4-133-18zm135-500c0-72-4-95-17-108-39-40-73 18-65 111 4 46 11 64 28 78 44 35 54 21 54-81z"/><path d="m4830 1475v-375h155 155v55 54l-87 3-88 3-3 318-2 317h-65-65v-375z"/><path d="m5220 1475v-375h155 155v55 54l-87 3-88 3-3 318-2 317h-65-65v-375z"/><path d="m5610 1475v-375h155 155v55 54l-87 3-88 3-3 103-3 102h76 75v55 54l-72 3-73 3-3 98-3 97h91 90v60 60h-155-155v-375z"/><path d="m6430 1790v-60h55 55v-315-315h65 65v315 315h55 55v60 60h-175-175v-60z"/></g></svg>';
						}else if($button_option == 3){
							$button_svg = '<?xml version="1.0" encoding="UTF-8"?><svg width="160px" height="46px" version="1.0" viewBox="0 0 988 287" xmlns="http://www.w3.org/2000/svg"><g transform="translate(0 287) scale(.1 -.1)"><path d="m535 2854c-256-55-466-267-519-526-24-115-24-1670 0-1786 53-262 263-472 526-526 70-14 489-16 4398-16s4328 2 4398 16c263 54 473 264 526 526 24 116 24 1670 0 1786-53 262-263 472-526 526-70 14-487 16-4405 15-3779-1-4337-3-4398-15zm8780-199c172-45 305-179 350-352 22-85 22-1651 0-1736-45-173-178-307-350-352-53-13-532-15-4375-15s-4322 2-4375 15c-172 45-305 179-350 352-22 85-22 1651 0 1736 45 171 177 306 346 351 47 13 635 15 4374 15 3849 1 4327-1 4380-14z"/><path d="m1810 1842c-23-11-43-33-58-62-22-44-23-51-20-315 3-299 6-311 67-352 27-18 48-23 100-23 122 0 161 46 169 197l5 93h-67-66v-66c0-98-30-134-65-80-14 21-16 58-13 250 3 202 5 227 21 243 18 17 19 17 38-6 13-16 19-39 19-77v-54h66 67l-5 79c-5 94-29 146-78 173-45 23-133 24-180 0z"/><path d="m2760 1842c-23-11-43-33-58-62-22-44-23-51-20-315 3-299 6-311 67-352 27-18 48-23 100-23 122 0 161 46 169 197l5 93h-67-66v-66c0-98-30-134-65-80-14 21-16 58-13 250 3 202 5 227 21 243 18 17 19 17 38-6 13-16 19-39 19-77v-54h66 67l-5 79c-5 94-29 146-78 173-45 23-133 24-180 0z"/><path d="m4350 1842c-23-11-43-33-58-62-22-44-23-51-20-315 3-299 6-311 67-352 27-18 48-23 100-23 122 0 161 46 169 197l5 93h-67-66v-66c0-98-30-134-65-80-14 21-16 58-13 250 3 202 5 227 21 243 18 17 19 17 38-6 13-16 19-39 19-77v-54h66 67l-5 79c-5 94-29 146-78 173-45 23-133 24-180 0z"/><path d="m4750 1841c-19-10-44-34-55-52-18-31-20-55-23-301-3-249-2-271 17-312 28-64 68-86 154-86 82 0 117 16 149 67 23 37 23 42 23 313 0 314-4 334-76 370-51 26-142 27-189 1zm121-118c11-13 14-66 14-249 0-205-2-235-17-250-21-21-45-12-59 23-16 42-8 456 10 476 17 21 35 21 52 0z"/><path d="m6230 1842c-23-11-43-33-58-62-22-44-23-51-20-315 3-299 6-311 67-352 27-18 48-23 100-23 122 0 161 46 169 197l5 93h-67-66v-66c0-98-30-134-65-80-14 21-16 58-13 250 3 202 5 227 21 243 18 17 19 17 38-6 13-16 19-39 19-77v-54h66 67l-5 79c-5 94-29 146-78 173-45 23-133 24-180 0z"/><path d="m7591 1845c-82-26-131-94-131-180 0-59 19-104 59-137 34-30 38-38 16-38-30 0-85-61-100-113-35-119 27-234 144-267 52-14 590-13 649 2 81 20 152 113 152 199 0 71-47 150-104 174l-29 13 27 17c64 42 86 158 45 242-15 30-35 52-67 71l-47 27-285 2c-221 2-295-1-329-12zm199-196v-111l-76 4c-71 3-78 6-105 36-22 24-29 42-29 73 0 78 40 108 148 109h62v-111zm376 96c78-32 80-146 4-186-23-13-56-19-97-19h-63v110 110h60c33 0 76-7 96-15zm-376-425v-120h-77c-43 0-89 6-102 13-38 19-66 64-66 106 0 87 47 120 168 121h77v-120zm406 105c70-29 83-131 24-190-29-28-36-30-120-33l-90-4v121 121h75c44 0 90-6 111-15z"/><path d="m2140 1475v-375h155 155v55 54l-87 3-88 3-3 318-2 317h-65-65v-375z"/><path d="m2490 1475v-375h65 65v375 375h-65-65v-375z"/><path d="m3090 1475v-375h65 65v113c0 109 13 167 26 122 3-11 22-67 43-125l37-105 73-3c67-3 73-1 66 15-30 78-136 381-137 393-1 8 29 83 66 165 37 83 70 156 73 163 4 10-11 12-67 10l-72-3-47-112c-25-61-50-115-54-119s-7 47-7 114v122h-65-65v-375z"/><path d="m3760 1832c-23-11-43-33-58-62-20-39-23-56-20-131 3-69 8-91 26-117l23-31-23-31c-20-27-23-46-26-141-7-181 26-236 135-225 32 3 94 5 138 5h80l-3 165c-3 145-1 166 12 166s16 12 16 55c0 42-3 55-15 55-11 0-15 12-15 45v45h-64-65l-3-42c-3-39-5-43-28-40-42 6-55 27-55 91 0 81 11 91 101 91h74v60 60h-97c-73 0-107-4-133-18zm135-500c0-72-4-95-17-108-39-40-73 18-65 111 4 46 11 64 28 78 44 35 54 21 54-81z"/><path d="m5080 1475v-375h155 155v55 54l-87 3-88 3-3 318-2 317h-65-65v-375z"/><path d="m5430 1475v-375h155 155v55 54l-87 3-88 3-3 318-2 317h-65-65v-375z"/><path d="m5780 1475v-375h155 155v55 54l-87 3-88 3-3 103-3 102h76 75v55 54l-72 3-73 3-3 98-3 97h91 90v60 60h-155-155v-375z"/><path d="m6520 1790v-60h55 55v-315-315h65 65v315 315h55 55v60 60h-175-175v-60z"/></g></svg>';
						}else if($button_option == 4){
							$button_svg = '<?xml version="1.0" encoding="UTF-8"?><svg width="160px" height="46px" version="1.0" viewBox="0 0 988 287" xmlns="http://www.w3.org/2000/svg"><g transform="translate(0 287) scale(.1 -.1)"><path d="m535 2854c-256-55-466-267-519-526-24-115-24-1670 0-1786 53-262 263-472 526-526 70-14 489-16 4398-16s4328 2 4398 16c263 54 473 264 526 526 24 116 24 1670 0 1786-53 262-263 472-526 526-70 14-487 16-4405 15-3779-1-4337-3-4398-15zm8780-199c172-45 305-179 350-352 22-85 22-1651 0-1736-45-173-178-307-350-352-53-13-532-15-4375-15s-4322 2-4375 15c-172 45-305 179-350 352-22 85-22 1651 0 1736 45 171 177 306 346 351 47 13 635 15 4374 15 3849 1 4327-1 4380-14z"/><path d="m8650 2010c-260-40-459-260-477-525-20-313 215-582 527-602 164-10 308 45 425 162s169 241 168 405c0 246-155 462-383 534-89 28-184 38-260 26zm236-41c230-70 384-277 384-516 0-162-49-282-160-393-285-284-757-167-891 220-29 86-32 239-5 320 63 187 204 328 377 374 82 22 214 20 295-5z"/><path d="m9071 1685c-105-23-186-54-249-95-99-64-143-137-149-250l-5-75 28 35c37 48 191 198 217 212 12 6-10-23-49-65-73-80-147-193-137-210 3-5 39-7 83-5 143 8 195 60 257 251 40 125 56 162 86 195 20 21 20 22 1 21-10 0-48-7-83-14z"/><path d="m8284 1554c24-23 33-44 62-136 27-86 59-139 97-160 32-17 93-26 128-19l30 6-41 60c-23 33-58 78-78 99l-37 39 32-22c17-11 59-51 92-88l61-66v42c0 79-44 149-126 197-39 23-177 64-216 64-18 0-18-1-4-16z"/><path d="m7057 1858c-77-21-137-105-137-193 1-43 32-107 68-137l31-26-28-12c-36-15-77-57-90-93-18-46-13-133 8-176 26-50 81-97 128-110 23-7 161-11 343-11 302 0 305 0 357 25 91 42 139 148 113 246-16 60-43 95-90 115l-39 18 30 18c59 36 87 155 55 231-17 43-76 93-123 106-49 14-574 13-626-1zm203-198v-110h-69c-54 0-75 5-102 23-40 27-56 72-43 119 15 52 64 78 145 78h69v-110zm373 101c44-17 67-51 67-99 0-37-6-50-34-78-32-32-38-34-105-34h-71v110 110h59c33 0 71-4 84-9zm-375-440 3-123-91 3c-91 4-92 4-126 41-45 50-48 112-6 159 32 36 74 48 157 46l60-2 3-124zm388 118c60-15 84-47 84-113 0-92-45-126-165-126h-75v125 125h56c30 0 75-5 100-11z"/><path d="m1010 1842c-23-11-43-33-58-62-22-44-23-51-20-315 3-299 6-311 67-352 27-18 48-23 100-23 122 0 161 46 169 197l5 93h-67-66v-66c0-98-30-134-65-80-14 21-16 58-13 250 3 202 5 227 21 243 18 17 19 17 38-6 13-16 19-39 19-77v-54h66 67l-5 79c-5 94-29 146-78 173-45 23-133 24-180 0z"/><path d="m2080 1842c-23-11-43-33-58-62-22-44-23-51-20-315 3-299 6-311 67-352 27-18 48-23 100-23 122 0 161 46 169 197l5 93h-67-66v-66c0-98-30-134-65-80-14 21-16 58-13 250 3 202 5 227 21 243 18 17 19 17 38-6 13-16 19-39 19-77v-54h66 67l-5 79c-5 94-29 146-78 173-45 23-133 24-180 0z"/><path d="m3860 1842c-23-11-43-33-58-62-22-44-23-51-20-315 3-299 6-311 67-352 27-18 48-23 100-23 122 0 161 46 169 197l5 93h-67-66v-66c0-98-30-134-65-80-14 21-16 58-13 250 3 202 5 227 21 243 18 17 19 17 38-6 13-16 19-39 19-77v-54h66 67l-5 79c-5 94-29 146-78 173-45 23-133 24-180 0z"/><path d="m4290 1841c-19-10-44-34-55-52-18-31-20-55-23-301-3-249-2-271 17-312 28-64 68-86 154-86 82 0 117 16 149 67 23 37 23 42 23 313 0 314-4 334-76 370-51 26-142 27-189 1zm121-118c11-13 14-66 14-249 0-205-2-235-17-250-21-21-45-12-59 23-16 42-8 456 10 476 17 21 35 21 52 0z"/><path d="m5930 1842c-23-11-43-33-58-62-22-44-23-51-20-315 3-299 6-311 67-352 27-18 48-23 100-23 122 0 161 46 169 197l5 93h-67-66v-66c0-98-30-134-65-80-14 21-16 58-13 250 3 202 5 227 21 243 18 17 19 17 38-6 13-16 19-39 19-77v-54h66 67l-5 79c-5 94-29 146-78 173-45 23-133 24-180 0z"/><path d="m1370 1475v-375h155 155v55 54l-87 3-88 3-3 318-2 317h-65-65v-375z"/><path d="m1760 1475v-375h65 65v375 375h-65-65v-375z"/><path d="m2440 1475v-375h65 65v113c0 109 13 167 26 122 3-11 22-67 43-125l37-105 73-3c67-3 73-1 66 15-30 78-136 381-137 393-1 8 29 83 66 165 37 83 70 156 73 163 4 10-11 12-67 10l-72-3-47-112c-25-61-50-115-54-119s-7 47-7 114v122h-65-65v-375z"/><path d="m3200 1832c-23-11-43-33-58-62-20-39-23-56-20-131 3-69 8-91 26-117l23-31-23-31c-20-27-23-46-26-141-7-181 26-236 135-225 32 3 94 5 138 5h80l-3 165c-3 145-1 166 12 166s16 12 16 55c0 42-3 55-15 55-11 0-15 12-15 45v45h-64-65l-3-42c-3-39-5-43-28-40-42 6-55 27-55 91 0 81 11 91 101 91h74v60 60h-97c-73 0-107-4-133-18zm135-500c0-72-4-95-17-108-39-40-73 18-65 111 4 46 11 64 28 78 44 35 54 21 54-81z"/><path d="m4660 1475v-375h155 155v55 54l-87 3-88 3-3 318-2 317h-65-65v-375z"/><path d="m5050 1475v-375h155 155v55 54l-87 3-88 3-3 318-2 317h-65-65v-375z"/><path d="m5440 1475v-375h155 155v55 54l-87 3-88 3-3 103-3 102h76 75v55 54l-72 3-73 3-3 98-3 97h91 90v60 60h-155-155v-375z"/><path d="m6260 1790v-60h55 55v-315-315h65 65v315 315h55 55v60 60h-175-175v-60z"/></g></svg>';
						}else{
							$button_svg = '<?xml version="1.0" encoding="UTF-8"?><svg width="160px" height="46px" version="1.0" viewBox="0 0 988 287" xmlns="http://www.w3.org/2000/svg"><g transform="translate(0 287) scale(.1 -.1)"><path d="m535 2854c-256-55-466-267-519-526-24-115-24-1670 0-1786 53-262 263-472 526-526 70-14 489-16 4398-16s4328 2 4398 16c263 54 473 264 526 526 24 116 24 1670 0 1786-53 262-263 472-526 526-70 14-487 16-4405 15-3779-1-4337-3-4398-15zm8780-199c172-45 305-179 350-352 22-85 22-1651 0-1736-45-173-178-307-350-352-53-13-532-15-4375-15s-4322 2-4375 15c-172 45-305 179-350 352-22 85-22 1651 0 1736 45 171 177 306 346 351 47 13 635 15 4374 15 3849 1 4327-1 4380-14z"/><path d="m2190 1842c-23-11-43-33-58-62-22-44-23-51-20-315 3-299 6-311 67-352 27-18 48-23 100-23 122 0 161 46 169 197l5 93h-67-66v-66c0-98-30-134-65-80-14 21-16 58-13 250 3 202 5 227 21 243 18 17 19 17 38-6 13-16 19-39 19-77v-54h66 67l-5 79c-5 94-29 146-78 173-45 23-133 24-180 0z"/><path d="m3260 1842c-23-11-43-33-58-62-22-44-23-51-20-315 3-299 6-311 67-352 27-18 48-23 100-23 122 0 161 46 169 197l5 93h-67-66v-66c0-98-30-134-65-80-14 21-16 58-13 250 3 202 5 227 21 243 18 17 19 17 38-6 13-16 19-39 19-77v-54h66 67l-5 79c-5 94-29 146-78 173-45 23-133 24-180 0z"/><path d="m5040 1842c-23-11-43-33-58-62-22-44-23-51-20-315 3-299 6-311 67-352 27-18 48-23 100-23 122 0 161 46 169 197l5 93h-67-66v-66c0-98-30-134-65-80-14 21-16 58-13 250 3 202 5 227 21 243 18 17 19 17 38-6 13-16 19-39 19-77v-54h66 67l-5 79c-5 94-29 146-78 173-45 23-133 24-180 0z"/><path d="m5470 1841c-19-10-44-34-55-52-18-31-20-55-23-301-3-249-2-271 17-312 28-64 68-86 154-86 82 0 117 16 149 67 23 37 23 42 23 313 0 314-4 334-76 370-51 26-142 27-189 1zm121-118c11-13 14-66 14-249 0-205-2-235-17-250-21-21-45-12-59 23-16 42-8 456 10 476 17 21 35 21 52 0z"/><path d="m7110 1842c-23-11-43-33-58-62-22-44-23-51-20-315 3-299 6-311 67-352 27-18 48-23 100-23 122 0 161 46 169 197l5 93h-67-66v-66c0-98-30-134-65-80-14 21-16 58-13 250 3 202 5 227 21 243 18 17 19 17 38-6 13-16 19-39 19-77v-54h66 67l-5 79c-5 94-29 146-78 173-45 23-133 24-180 0z"/><path d="m2550 1475v-375h155 155v55 54l-87 3-88 3-3 318-2 317h-65-65v-375z"/><path d="m2940 1475v-375h65 65v375 375h-65-65v-375z"/><path d="m3620 1475v-375h65 65v113c0 109 13 167 26 122 3-11 22-67 43-125l37-105 73-3c67-3 73-1 66 15-30 78-136 381-137 393-1 8 29 83 66 165 37 83 70 156 73 163 4 10-11 12-67 10l-72-3-47-112c-25-61-50-115-54-119s-7 47-7 114v122h-65-65v-375z"/><path d="m4380 1832c-23-11-43-33-58-62-20-39-23-56-20-131 3-69 8-91 26-117l23-31-23-31c-20-27-23-46-26-141-7-181 26-236 135-225 32 3 94 5 138 5h80l-3 165c-3 145-1 166 12 166s16 12 16 55c0 42-3 55-15 55-11 0-15 12-15 45v45h-64-65l-3-42c-3-39-5-43-28-40-42 6-55 27-55 91 0 81 11 91 101 91h74v60 60h-97c-73 0-107-4-133-18zm135-500c0-72-4-95-17-108-39-40-73 18-65 111 4 46 11 64 28 78 44 35 54 21 54-81z"/><path d="m5840 1475v-375h155 155v55 54l-87 3-88 3-3 318-2 317h-65-65v-375z"/><path d="m6230 1475v-375h155 155v55 54l-87 3-88 3-3 318-2 317h-65-65v-375z"/><path d="m6620 1475v-375h155 155v55 54l-87 3-88 3-3 103-3 102h76 75v55 54l-72 3-73 3-3 98-3 97h91 90v60 60h-155-155v-375z"/><path d="m7440 1790v-60h55 55v-315-315h65 65v315 315h55 55v60 60h-175-175v-60z"/></g></svg>';
						}
						$infoSVG ='<svg version="1.0" xmlns="http://www.w3.org/2000/svg" width="682.667" height="682.667" viewBox="0 0 512 512"><path d="M232.1 1c-49.7 4.8-99 25.1-137.6 56.5-11.4 9.2-29.4 27.4-38.4 38.7-22.9 28.7-41.7 67.5-49.5 102.3-4.9 21.8-6 32.5-6 57.5s1.1 35.7 6 57.5c7.9 35.5 27.2 74.9 50.9 104 9.2 11.4 27.4 29.4 38.7 38.4 28.7 22.9 67.5 41.7 102.3 49.5 21.8 4.9 32.5 6 57.5 6s35.7-1.1 57.5-6c26.1-5.8 60.3-20.4 82.8-35.3 38.9-25.9 68.8-59.9 89.3-101.6 12.5-25.5 19.6-48.4 24.1-77.5 2.4-16.1 2.4-53.9 0-70-4.5-29.1-11.6-52-24.1-77.5-13.4-27.2-28.3-48-49.8-69.2-21.1-20.9-40.4-34.6-67.3-47.8-25.2-12.4-48.6-19.7-76.5-24C279.4.6 245.2-.2 232.1 1zM288 25.6c50.8 7.4 96.7 30.3 132.4 66 35.9 35.8 58.1 80.4 66.2 132.9 1.2 7.7 1.7 17.2 1.7 31.5 0 37.8-7.5 69.8-24 103.2-34.3 69.3-98 115.2-176.8 127.4-15.1 2.3-47.9 2.3-63 0-52.5-8.1-97.1-30.3-132.9-66.2-35.9-35.8-58.1-80.4-66.2-132.9-2.3-15.1-2.3-47.9 0-63 4.2-26.7 11.1-49.2 22.3-71.7C81.4 84.8 144.7 38.4 221 26c19.3-3.2 46.8-3.3 67-.4z"/><path d="M271.1 129.4c-9.4 3.1-18.4 11.6-21.1 20-3.1 9.8.5 22.5 8.5 29.5 17.6 15.4 47.1 8.8 54.1-12.1 6.2-18.8-8.1-37.6-29.5-38.5-4.7-.2-9.3.3-12 1.1zM238.1 215.1c-6.9 1.2-34.2 10.5-35.7 12.2-1.1 1.2-4.7 13.7-4.1 14.3.1.2 3.2-.6 6.7-1.7 14-4.4 27-2.4 30.4 4.7 3.5 7.5 1.8 18-9.4 56.1-8.6 29.4-10.1 36.4-10.2 47.8-.1 7.4.3 9.9 2.1 14.2 3 6.7 10.3 13.6 18.9 17.6 6 2.8 7.8 3.1 18.3 3.5 14.1.5 20.7-.8 39.4-7.6l13-4.8 1.9-6.7c1.1-3.7 1.7-6.9 1.4-7.2-.3-.3-2.5.2-4.9 1.1-6.5 2.5-23.3 2.5-27.7.1-10.4-5.7-9.8-15.3 4.2-63.4 8.8-30.1 9.6-33.8 9.7-45.5.1-16.7-5.3-25.3-20.1-32.1-5.8-2.7-7.7-3.1-17.5-3.3-6-.2-13.5.1-16.4.7z"/></svg>';
						echo sprintf( '<div class="clear"> </div><div class="wc-proceed-to-checkout input-group">
						<div class="input-group-btn">
							<span id="hubbed-btn-click-collect" class="hubbed-popup-button hubbed-toggle hubbed-clickbtn">%s</span>
							<span class="hubbed-learn-more" onclick="learnMorePopupHubbed(event)">%s</span></div>
						</div>
						</div>',$button_svg,$infoSVG);
						// Add the hubbed popup
						include_once 'includes/location-popup.php';
						
					} 
				}

} // enable / disable

} // check store id
} 



// show the hubbed address at checkout page after the billing information.
add_action('woocommerce_after_checkout_billing_form','hubbed_sethubbedaddress_checkout');
if ( ! function_exists( 'hubbed_sethubbedaddress_checkout' ) )
{
	function hubbed_sethubbedaddress_checkout()
	{

		if(isset($_SESSION['hubbed_selectaddress']))
		{
			echo '<div class="hubbed_checkout_address">'; 
//echo '<div class="cross_hubbed_checkout_address" id="cross_hubbed_checkout_address"><span class="dashicons dashicons-no-alt"></span></div>';
			echo '<p> CLICK & COLLECT Address</p>';

			echo '<textarea readonly name="hubbed_checkout_address_feild">'.$_SESSION["hubbed_selectaddress"].'</textarea>';
			echo'<input type="hidden" name="hubbed_checkout_storeDlb" id="ship_to_hubbed_storeDlb" value="'.$_SESSION['hubbed_hubbedlb'].'">';
			echo '</div>';
		}
	}
}



// Save the address and data during the order with hubbed
add_action('woocommerce_checkout_update_order_meta','hubbed_orderhubbed_address',20,1);
if ( ! function_exists( 'hubbed_orderhubbed_address' ) )
{

	function hubbed_orderhubbed_address($order_id)
	{
		global $wpdb;
		session_start();
		$hubbed_id = "";
		$user_id = get_current_user_id();
		if(isset($_POST['hubbed_checkout_address_feild']) && !empty($_POST['hubbed_checkout_address_feild']))
		{

			$articles = array();
              $count = 0;
              $order = wc_get_order( $order_id ); 
              foreach ( $order->get_items() as $item ) 
              {
                $product_id = absint($item['product_id']);
                $product = wc_get_product( $product_id );
                $productweight = $product->get_weight();
                $weight = 1;
                if ( empty($productweight) or $productweight < 1)
                 {
                  $weight = 1;
                  }else{ 
                    $weight = $product->get_weight(); 
                  }
                  $sku = $product->get_sku();
                  if(empty($sku)){
                  $sku = $product->get_id();
                  }
                $articles[$count]["barcode"] = ($sku.'_'.get_post_meta( $hubbed_enable_order_id, 'hubbed_client_id', true ));
                $articles[$count]["volume"]= (($item ->get_quantity() != null) ? $item ->get_quantity() : '');
                $articles[$count]["weight"]= $weight;
                $count++;
              }

    //$hubbed_address = $_SESSION['hubbed_selectaddress'];


  // call Client hubbed Api for hubbed id
			$api_key = get_option('hubbed_api_key');
			$path1 = HUBBED_CLIENT_API_URL.'auth/token/';
			$apidata0 = array(
            'body' => array('hubbed_error'=>1), // hubbed_error is passed for slove the content lenth. it is dummy data.
            'timeout' => '45',
            'redirection' => '5',
            'httpversion' => '1.0',
            'blocking' => true,
            'sslverify'   => false,
            'headers' => array(
            	'APIKEY' => $api_key,
            	'Content-Type' => 'application/json',
            ),
            'cookies' => array(),
        );

			$response = wp_remote_post($path1, $apidata0);
         // print_r($response);
			$body = wp_remote_retrieve_body($response);
			$gettoken = json_decode($body, true);
			$hubbedtoken = $gettoken['responseMessage'];
			if (empty($hubbedtoken)) {
				$response = wp_remote_post($path1, $apidata0);
				$body = wp_remote_retrieve_body($response);
				$gettoken = json_decode($body, true);
				$hubbedtoken = $gettoken['responseMessage'];
			}

			$path2 = HUBBED_CLIENT_API_URL.'ecommercecustomer/gethubbedid/';
			$apidata1 = array(
            'body' => array('hubbed_error'=>1), // hubbed_error is passed for slove the content lenth. it is dummy data.
            'timeout' => '45',
            'redirection' => '5',
            'httpversion' => '1.0',
            'blocking' => true,
            'sslverify'   => false,
            'headers' => array(
            	'Authorization' => 'Bearer '.$hubbedtoken,
            	'Content-Type' => 'application/json;charset=UTF-8',

            ),
            'cookies' => array(),
        );

			$response = wp_remote_get($path2, $apidata1);
         // print_r($response);
			$body = wp_remote_retrieve_body($response);
			$gethubbedid = json_decode($body, true);
			$hubbed_id = $gethubbedid['result']['success']['hubbed_id'];
			update_post_meta( $order_id, 'hubbed_consignment_no',$hubbed_id);
            
			if (empty($hubbed_id)) {
				$response = wp_remote_get($path2, $apidata1);
				$body = wp_remote_retrieve_body($response);
				$gethubbedid = json_decode($body, true);
				$hubbed_id = $gethubbedid['result']['success']['hubbed_id'];  
			}


			$hubbed_key_location = get_option('hubbed_key_location');


			$order = wc_get_order( $order_id );


			$firstname = $order->get_shipping_first_name();
			$lastname = $order->get_shipping_last_name();
			$email = $order->get_billing_email();
			if ( empty($firstname) || empty($lastname)) 
			{

				$firstname = $order->get_billing_first_name();
				$lastname = $order->get_billing_last_name();

			}
			
			update_post_meta($order_id,'_shipping_company',$_SESSION['hubbed_company']);
			update_post_meta($order_id,'_shipping_address_1',$_SESSION['hubbed_address']);
			update_post_meta($order_id,'_shipping_city',$_SESSION['hubbed_city']);
			update_post_meta($order_id,'_shipping_state',$_SESSION['hubbed_state']);
			update_post_meta($order_id,'_shipping_postcode',$_SESSION['hubbed_zip']); 

			if ($hubbed_key_location == 'first') {  
				$firstname = $firstname.'[Hubbed - '.$hubbed_id.']';
				$ship_firstname  = get_post_meta($order_id,'_shipping_first_name',true);
				if(!empty($ship_firstname))
				{
					$ship_firstname = $ship_firstname.'[Hubbed - '.$hubbed_id.']';
					update_post_meta($order_id,'_shipping_first_name',$ship_firstname); 
				}
			}

			if ($hubbed_key_location == 'last') {  
				$lastname = $lastname.'[Hubbed - '.$hubbed_id.']';
				$ship_lastname  = get_post_meta($order_id,'_shipping_last_name',true);
				if(!empty($ship_lastname))
				{
					$ship_lastname = $ship_lastname.'[Hubbed - '.$hubbed_id.']';
					update_post_meta($order_id,'_shipping_last_name',$ship_lastname); 
				}
			}
			if ($hubbed_key_location == 'address') { 
				$hubbed_street = $_SESSION['hubbed_address'].'[Hubbed - '.$hubbed_id.']';

				$ship_address1  = get_post_meta($order_id,'_shipping_address_1',true);
				if(!empty($ship_address1))
				{
					$ship_address1 = $ship_address1.'[Hubbed - '.$hubbed_id.']';
					update_post_meta($order_id,'_shipping_address_1',$ship_address1); 
				}

			}else{ $hubbed_street = $_SESSION['hubbed_address']; }

			if ($hubbed_key_location == 'city') { 
				$hubbed_city = $_SESSION['hubbed_city'].'[Hubbed - '.$hubbed_id.']';
				$ship_city  = get_post_meta($order_id,'_shipping_city',true);
				if(!empty($ship_city))
				{
					$ship_city = $ship_city.'[Hubbed - '.$hubbed_id.']';
					update_post_meta($order_id,'_shipping_city',$ship_city); 
				}

			}else{ $hubbed_city = $_SESSION['hubbed_city']; }

			$hubbed_address = $firstname.' '.$lastname.'|'.$_SESSION['hubbed_company'].'|'.$hubbed_street.'|'.$hubbed_city.' , '.$_SESSION['hubbed_state'].'|'.$_SESSION['hubbed_country'].' , '. $_SESSION['hubbed_zip'];



  //$hubbed_address = $_SESSION['hubbed_selectadminaddress'];
			update_post_meta($order_id,'hubbed_checkout_address',$hubbed_address);
			update_post_meta($order_id,'hubbed_enable_address',1);
			update_post_meta($order_id,'hubbed_client_id', $hubbed_id);



// Call the Api during order
			if (empty($hubbed_id)) {
				$hubbed_id = "empty";
			}

			$firstname1 = $order->get_shipping_first_name();
			$lastname1 = $order->get_shipping_last_name();
			if ( empty($firstname1) || empty($lastname1)) 
			{

				$firstname1 = $order->get_billing_first_name();
				$lastname1 = $order->get_billing_last_name();

			}

			$hubbed_hubbedlb = $_POST['hubbed_checkout_storeDlb'];
			$orderdata = array();
			$passdata['store_id'] = (get_option('hubbed_store_id'));
			$passdata['store_key'] = (get_option('hubbed_api_key'));
			$passdata['order_id'] = $order_id;
			$passdata['contactName'] = $firstname1.' '.$lastname1;
			$passdata['emailaddress'] = $email;
			$passdata['hubbedid'] = $hubbed_id;
			$passdata['storedlb'] = $hubbed_hubbedlb;
			$passdata['articles'] = ((isset($articles) && $articles != null) ? $articles : []);
			$body = hubbed_api_call('/order/create', $passdata);
			update_post_meta($order_id ,'error',$body);
			if (isset($body['result'][0]) && $body['result'][0]['responseCode'] == 200 ) 
			{
				update_post_meta( $order_id, 'hubbed_consignment_status','success');
			}
			else
			{
				update_post_meta( $order_id, 'hubbed_consignment_status','error');
				
			}
			
		}

		if(isset($_SESSION['hubbed_hubbedlb']) && isset($_POST['hubbed_checkout_storeDlb']) && !empty($_POST['hubbed_checkout_storeDlb'])){
    //$hubbed_hubbedlb = $_SESSION["hubbed_hubbedlb"];
			$hubbed_hubbedlb = $_POST['hubbed_checkout_storeDlb'];
			update_post_meta($order_id,'hubbed_checkout_hubbedlb',$hubbed_hubbedlb);
		}


	}}



// Show the hubbed address and data at order page or post.
	add_action( 'woocommerce_admin_order_data_after_shipping_address', 'hubbed_consignment_response' );

	function hubbed_consignment_response( $order )
	{  

		if(get_post_meta($order->id,'hubbed_enable_address',true)==1)
		{

			?>

			<br class="clear" />
			<p style="margin-bottom: 0px;"><b>Hubbed Details</b></p>
			<?php 
        //$hubbed_consignment_response = json_decode(get_post_meta( $order->id, 'hubbed_consignment_response', true ));
			$hubbed_address = (get_post_meta( $order->id, 'hubbed_checkout_address', true ));
			$hubbed_address_array = explode('|',$hubbed_address);
			echo '<div class="orderhubbedaddress">';
			foreach ($hubbed_address_array as $hubbed_addres) {

				echo $hubbed_addres.'<br/>';
			}
			$hubbed_storeDlb = (get_post_meta( $order->id, 'hubbed_checkout_hubbedlb', true ));
			?>
			<br/>
			<p><b>Hubbed store Dlb - </b><?php echo $hubbed_storeDlb; ?></p>  
			<p style="margin-bottom:0px;"><b>Consignment No. - </b><?php echo (get_post_meta( $order->id, 'hubbed_consignment_no', true )); ?></p> 

		</div>
		<?php
	}
}



  // Shipping  Calculation 

add_action('woocommerce_cart_calculate_fees', function() {

	if(Is_checkout())
	{


		if(get_option('hubbed_shipping_fee') == 1)
		{ 
			$hubbed_cutoff_price = get_option('hubbed_cutoff_price');
			$hubbed_lower_price = get_option('hubbed_lower_price');
			$hubbed_higher_price = get_option('hubbed_higher_price');
			$subtotal = WC()->cart->subtotal;

			if(isset($_SESSION['hubbed_address']) && !empty($_SESSION['hubbed_address']))
			{
				if ($subtotal < $hubbed_cutoff_price) 
				{
					if (!empty($hubbed_lower_price)) 
					{
						WC()->cart->add_fee('Click & Collect Shipping Fee', $hubbed_lower_price);
					}

				}else
				{
					if (!empty($hubbed_higher_price)) 
					{
						WC()->cart->add_fee('Click & Collect Shipping Fee', $hubbed_higher_price);
					} 

				}


			}


} // Check shipping enable or not
}
});

// Session INIT
add_action('init', 'hubbed_session_new');
function hubbed_session_new()
{
	if( ! session_id() ) 
	{
		session_start();
	}
}



// Removed the Sesssion 
add_action( 'template_redirect', 'removed_hubbed_session' );
function removed_hubbed_session()
{
	$ceckoutid = get_option( 'woocommerce_checkout_page_id');
	if ( !is_page( $ceckoutid ) ) 
	{

		$_SESSION['hubbed_selectaddress'] = $_SESSION['hubbed_address'] = $_SESSION['hubbed_city'] = $_SESSION['hubbed_state'] = "";
		if(isset($_SESSION["hubbed_selectaddress"])) { unset($_SESSION["hubbed_selectaddress"]); }
		if(isset($_SESSION['hubbed_address'])) { unset($_SESSION['hubbed_address']); }
		if(isset($_SESSION['hubbed_city'])) { unset($_SESSION['hubbed_city']); }
		if(isset($_SESSION['hubbed_state'])) { unset($_SESSION['hubbed_state']); }
		if(isset($_SESSION['hubbed_country'])) { unset($_SESSION['hubbed_country']); }
		if(isset($_SESSION['hubbed_zip'])) { unset($_SESSION['hubbed_zip']); }
		if(isset($_SESSION['hubbed_hubbedlb'])){ unset($_SESSION['hubbed_hubbedlb']); }
		
		if(isset($_SESSION["hubbed_selectaddress"])) 
		{
			global $woocommerce;
			$woocommerce->customer->set_shipping_first_name('');
			$woocommerce->customer->set_shipping_last_name('');
			$woocommerce->customer->set_shipping_company('');
			$woocommerce->customer->set_shipping_address_1('');
			$woocommerce->customer->set_shipping_address_2('');
			$woocommerce->customer->set_shipping_country('');
			$woocommerce->customer->set_shipping_state('');
			$woocommerce->customer->set_shipping_city('');
			$woocommerce->customer->set_shipping_postcode('') ;
		}
	}
}

add_action('woocommerce_before_cart', 'woocommerce_proceed_to_checkout_function',10);
function woocommerce_proceed_to_checkout_function() 
{

	$_SESSION['hubbed_selectaddress'] = $_SESSION['hubbed_address'] = $_SESSION['hubbed_city'] = $_SESSION['hubbed_state'] = "";
	if(isset($_SESSION["hubbed_selectaddress"])) { unset($_SESSION["hubbed_selectaddress"]); }
	if(isset($_SESSION['hubbed_address'])) { unset($_SESSION['hubbed_address']); }
	if(isset($_SESSION['hubbed_city'])) { unset($_SESSION['hubbed_city']); }
	if(isset($_SESSION['hubbed_state'])) { unset($_SESSION['hubbed_state']); }
	if(isset($_SESSION['hubbed_country'])) { unset($_SESSION['hubbed_country']); }
	if(isset($_SESSION['hubbed_zip'])) { unset($_SESSION['hubbed_zip']); }
	if(isset($_SESSION['hubbed_hubbedlb'])){ unset($_SESSION['hubbed_hubbedlb']); }

	if(isset($_SESSION["hubbed_selectaddress"])) 
	{
		global $woocommerce;
		$woocommerce->customer->set_shipping_first_name('');
		$woocommerce->customer->set_shipping_last_name('');
		$woocommerce->customer->set_shipping_company('');
		$woocommerce->customer->set_shipping_address_1('');
		$woocommerce->customer->set_shipping_address_2('');
		$woocommerce->customer->set_shipping_country('');
		$woocommerce->customer->set_shipping_state('');
		$woocommerce->customer->set_shipping_city('');
		$woocommerce->customer->set_shipping_postcode('') ;
	}
}